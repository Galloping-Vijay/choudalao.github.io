---
title: "Nginx PHP多站点配置"
date: 2018-01-08T10:19:17+08:00
updated: 2026-02-23T06:37:28+08:00
author: "臭大佬"
categories: [linux]
description: "Nginx PHP多站点配置"
cover: "http://www.choudalao.com/uploads/20191016/JwBebOmUcmmW3jASYNvYRo72hop3TdEUGYubV7va.jpeg"
click: 3350
---

&lt;p microsoft=&quot;&quot; white-space:=&quot;&quot; background-color:=&quot;&quot;&gt;以配置2个站点（2个域名）为例，n 个站点可以相应增加调整，假设：&lt;/p&gt;&lt;p microsoft=&quot;&quot; white-space:=&quot;&quot; background-color:=&quot;&quot;&gt;IP地址: 202.55.1.100&amp;nbsp;&lt;br&gt;域名1 example1.com 放在 /www/example1&amp;nbsp;&lt;br&gt;域名2 example2.com 放在 /www/example2&lt;/p&gt;&lt;p microsoft=&quot;&quot; white-space:=&quot;&quot; background-color:=&quot;&quot;&gt;配置 nginx virtual hosting 的基本思路和步骤如下：&amp;nbsp;&lt;br&gt;把2个站点 example1.com, example2.com 放到 nginx 可以访问的目录 /www/&amp;nbsp;&lt;br&gt;给每个站点分别创建一个 nginx 配置文件 example1.com.conf，example2.com.conf, 并把配置文件放到 /etc/nginx/vhosts/&amp;nbsp;&lt;br&gt;然后在 /etc/nginx.conf 里面加一句 include 把步骤2创建的配置文件全部包含进来（用 * 号）&amp;nbsp;&lt;br&gt;重启 nginx&lt;/p&gt;&lt;p microsoft=&quot;&quot; white-space:=&quot;&quot; background-color:=&quot;&quot;&gt;&lt;strong&gt;具体过程如下:&lt;/strong&gt;&lt;/p&gt;&lt;p microsoft=&quot;&quot; white-space:=&quot;&quot; background-color:=&quot;&quot;&gt;1、在 /etc/nginx 下创建 vhosts 目录&lt;/p&gt;&lt;pre lay-lang=&quot;JavaScript&quot;&gt;&lt;code class=&quot;JavaScript&quot;&gt;mkdir /etc/nginx/vhosts&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;span microsoft=&quot;&quot; background-color:=&quot;&quot;&gt;2、在 /etc/nginx/vhosts/ 里创建一个名字为 example1.com.conf 的文件，把以下内容拷进去&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre lay-lang=&quot;JavaScript&quot;&gt;&lt;code class=&quot;JavaScript&quot;&gt;server {
        listen  80;
        server_name  example1.com www. example1.com;

        access_log  /www/access_ example1.log  main;

        location / {
            root  /www/example1.com;
            index  index.php index.html index.htm;
        }

        error_page  500 502 503 504  /50x.html;
        location = /50x.html {
            root  /usr/share/nginx/html;
        }      # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        location ~ /.php$ {
            fastcgi_pass  127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /www/example1.com/$fastcgi_script_name;
            include        fastcgi_params;
        }

        location ~ //.ht {
            deny  all;
        }
}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span microsoft=&quot;&quot; background-color:=&quot;&quot;&gt;&lt;/span&gt;&lt;span microsoft=&quot;&quot; background-color:=&quot;&quot;&gt;3、在 /etc/nginx/vhosts/ 里创建一个名字为 example2.com.conf 的文件，把以下内容拷进去&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre lay-lang=&quot;JavaScript&quot;&gt;&lt;code class=&quot;JavaScript&quot;&gt;server {
        listen  80;
        server_name  example2.com www. example2.com;

        access_log  /www/access_ example1.log  main;

        location / {
            root  /www/example2.com;
            index  index.php index.html index.htm;
        }

        error_page  500 502 503 504  /50x.html;
        location = /50x.html {
            root  /usr/share/nginx/html;
        }      # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        location ~ /.php$ {
            fastcgi_pass  127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /www/example2.com/$fastcgi_script_name;
            include        fastcgi_params;
        }

        location ~ //.ht {
            deny  all;
        }
}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span microsoft=&quot;&quot; background-color:=&quot;&quot;&gt;4、打开 /etc/nginix.conf 文件，在相应位置加入 include 把以上2个文件包含进来&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre lay-lang=&quot;JavaScript&quot;&gt;&lt;code class=&quot;JavaScript&quot;&gt;user  nginx;
worker_processes  1;

# main server error log
error_log /var/log/nginx/error.log ;
pid /var/run/nginx.pid;

events { 
worker_connections  1024;
}
# main server config
http { 
include       mime.types; 
default_type  application/octet-stream; l
og_format  main  '$remote_addr - $remote_user [$time_local] $request '
                      '&quot;$status&quot; $body_bytes_sent &quot;$http_referer&quot; '
                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;'; 
sendfile        on; 
#tcp_nopush     on;
     #keepalive_timeout  0;
 keepalive_timeout  65; 
gzip  on; 
server {        
 listen         80;         
 server_name     _;         
 access_log      /var/log/nginx/access.log main;         
 server_name_in_redirect  off;         
 location / {              
         root  /usr/share/nginx/html;              
         index index.html;
         }
 }   
          # 包含所有的虚拟主机的配置文件
    include /etc/nginx/vhosts/*;
}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span microsoft=&quot;&quot; background-color:=&quot;&quot;&gt;&lt;/span&gt;&lt;span microsoft=&quot;&quot; background-color:=&quot;&quot;&gt;5、重启 Nginx&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;pre lay-lang=&quot;JavaScript&quot;&gt;&lt;code class=&quot;JavaScript&quot;&gt;/etc/init.d/nginx restart&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span microsoft=&quot;&quot; background-color:=&quot;&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;6、&lt;/span&gt;在win环境下,对于用TP框架开发的项目,有些静态文件加载报404,可以这样配置&lt;/p&gt;&lt;pre lay-lang=&quot;JavaScript&quot;&gt;&lt;code class=&quot;JavaScript&quot;&gt;server {
        listen       80;
        server_name  dev.web.com;
        location / {
            root   D:/phpStudy/WWW/web;
            index  index.html index.htm index.php;
            # Nginx环境配置，隐藏ThinkPHP public index.php入口
              #try_files $uri $uri/ /index.php?s=$uri&amp;amp;$args;
              try_files $uri $uri/ /index.php?s=$args;
              if (!-e $request_filename) {
                      rewrite  ^(.*)$  /index.php?s=/$1  last;
                      break;
              }
        }
        location ~ \.php$ {
            root          D:/phpStudy/WWW/web;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_split_path_info ^(.+\.php)(.*)$;     #增加这一句
            fastcgi_param PATH_INFO $fastcgi_path_info;    #增加这一句
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
            include        fastcgi_params; 
        }       
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://blog.csdn.net/ouyangzhan/article/details/6015243#comments&quot;&gt;转载自: http://blog.csdn.net/ouyangzhan/article/details/6015243#comments&lt;/a&gt;