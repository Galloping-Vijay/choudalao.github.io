---
title: "wsl里面使用宝塔"
date: 2022-10-07T10:31:39+08:00
updated: 2026-02-23T07:08:24+08:00
author: "臭大佬"
categories: [linux]
description: "wsl里面使用宝塔"
cover: "https://www.choudalao.com/images/config/default-img.jpg"
click: 3736
---

# linux 一键启动
由于在 Wsl2 中没有权限操作 Win10 的 hosts 文件，所以我们需要先解决该问题。

#### 获取hosts文件权限 
打开`C:\Windows\System32\drivers\etc`文件夹找到`hosts`文件，
右键->属性->安全->编辑->组或用户名中选中Users->完全控制打钩->应用->确定

![](https://www.choudalao.com/uploads/20221010/20221010234833UiGwg8.png)

如果经常操作`host`文件，可以发送到桌面快捷方式：
![](https://www.choudalao.com/uploads/20221010/20221010234619OpWcwz.png)

权限开启后，我们就可以修改`hosts`文件了。

#### 脚本
##### 设置默认root登录
`cmd` 命令行下，设置默认root登录，ubuntu+tab键就会出来ubuntuxxx.exe
```go
ubuntuxxx.exe config --default-user root
```

`cmd` 中输入`bash`进入 `wsl` ,进入用户目录 `cd ~` ，编辑`init.sh`文件 `vim init.sh`。
```go
#/bin/bash
echo "开启wsl及其相关启动项：bt、nginx、mysqld、redis、memcached、php、ftp、docker"
echo "bt 启动："
/etc/init.d/bt start
echo "nginx 启动："
/etc/init.d/nginx start
echo "mysqld 启动："
/etc/init.d/mysqld start
echo "redis 启动："
/etc/init.d/redis start
echo "memcached 启动："
/etc/init.d/memcached start
echo "php 启动："
/etc/init.d/php-fpm-72 start
echo "ftp 启动："
/etc/init.d/pure-ftpd start
echo "docker 启动："
service docker start
echo "启动完成！"
echo ""
# 为 win 设置 wsl host
echo "为 win 设置 wsl host"
# win hosts 文件路径
win_hosts_path="/mnt/c/Windows/System32/drivers/etc/hosts"
# 为 wsl2 设置的域名
echo "为 wsl2 设置的域名:dev.wsl.net"
wsl_domain="dev.wsl.net"
# 获取 wsl2 的 ip
wsl_ip=$(ifconfig eth0 | grep -w inet | awk '{print $2}')
echo "wsl2的ip:$wsl_ip"
# 判断是否已存在 wsl2 的域名，如果存在则修改，否则追加
if grep -wq "$wsl_domain" $win_hosts_path
then
    # 此处因为权限问题没有直接用 sed 修改 hosts 文件
    win_hosts=$(sed -s "s/.* $wsl_domain/$wsl_ip $wsl_domain/g" $win_hosts_path)
    echo "$win_hosts" > $win_hosts_path
else
    echo "$wsl_ip $wsl_domain" >> $win_hosts_path
fi

# 为 wsl 设置 win host
wsl_hosts_path="/etc/hosts"
win_domain="dev.win.net"
win_ip=$(cat /etc/resolv.conf | grep "nameserver" | awk '{print $2}')
if grep -wq "$win_domain" $wsl_hosts_path
then
    wsl_hosts=$(sed -s "s/.* $win_domain/$win_ip $win_domain/g" $wsl_hosts_path)
    echo $wsl_hosts > $wsl_hosts_path
else
    echo "$win_ip $win_domain" >> $wsl_hosts_path
fi
```
给权限
```go
chmod +x init.sh
```
执行
```go
sh init.sh
```

# 站点绑定
###  获取 `wsl` 的 `ip`
`ip addr | grep eth0` 或者 `ip addr` 查看 `ip`
![](https://www.choudalao.com/uploads/20221007/20221007110618OQFhiS.png)

### 从`wsl`访问主机的服务
在`wsl`里面执行如下命令：
```go
 cat /etc/resolv.conf | grep nameserver | awk '{ print $2 }'
```
出来的`ip`就是主机`ip`，
![](https://www.choudalao.com/uploads/20221007/20221007110918v5NBRA.png)



### 改`win`下的`host`进行绑定域名，例如：
```go
# host 文件添加
192.168.0.104  dev.host.net
```
![](https://www.choudalao.com/uploads/20221007/20221007102224EyBGFB.png)

![](https://www.choudalao.com/uploads/20221007/20221007102247JWFQVT.png)

![](https://www.choudalao.com/uploads/20221007/20221007102333stDmuG.png)

## 建立软连接，连接本地文件夹
```
ln -s 源文件 目标文件
# 移除软连接
rm -rf 目标文件
```

我们把`wsl`中的`/www/wwwroot`目录印射到本地的`d/wwwroot`,在`wsl`中，`/mnt/d/wwwroot` 指的是本地`d`盘下的`wwwroot`,
建立连接之前先把目标文件(/www/wwwroot)的wwwroot文件删除，要不就会在他里面创建，
```go
ln -s /mnt/d/wwwroot /www/wwwroot
```
![](https://www.choudalao.com/uploads/20221007/20221007102807cJutOW.png)

# 问题
#### WSL中宝塔数据库无法使用
https://www.bt.cn/bbs/forum.php?mod=viewthread&tid=65196&highlight=wsl

#### 解决 Win10 Wsl2 IP 变化问题
其实就是一键启动的步骤，给`win`的 `host`文件权限,然后设置域名，`init.sh`文件的简版`wsl.sh`：
```go
#!/bin/bash
# 为 win 设置 wsl host
echo "为 win 设置 wsl host"
# win hosts 文件路径
win_hosts_path="/mnt/c/Windows/System32/drivers/etc/hosts"
# 为 wsl2 设置的域名
echo "为 wsl2 设置的域名:dev.wsl.net"
wsl_domain="dev.wsl.net"
# 获取 wsl2 的 ip
wsl_ip=$(ifconfig eth0 | grep -w inet | awk '{print $2}')
echo "wsl2的ip:$wsl_ip"
# 判断是否已存在 wsl2 的域名，如果存在则修改，否则追加
if grep -wq "$wsl_domain" $win_hosts_path
then
    # 此处因为权限问题没有直接用 sed 修改 hosts 文件
    win_hosts=$(sed -s "s/.* $wsl_domain/$wsl_ip $wsl_domain/g" $win_hosts_path)
    echo "$win_hosts" > $win_hosts_path
else
    echo "$wsl_ip $wsl_domain" >> $win_hosts_path
fi

# 为 wsl 设置 win host
wsl_hosts_path="/etc/hosts"
win_domain="dev.win.net"
win_ip=$(cat /etc/resolv.conf | grep "nameserver" | awk '{print $2}')
if grep -wq "$win_domain" $wsl_hosts_path
then
    wsl_hosts=$(sed -s "s/.* $win_domain/$win_ip $win_domain/g" $wsl_hosts_path)
    echo $wsl_hosts > $wsl_hosts_path
else
    echo "$win_ip $win_domain" >> $wsl_hosts_path
fi

```

#### 解决php项目域名绑定
当然，如果是像php项目，需要在host文件做域名和ip的绑定，当wsl系统的ip变化时，我们可以把常用的域名绑定的ip一一替换，可以在上面脚本的基础上做个升级：
wsl.sh文件
```go
#!/bin/bash
# 为 win 设置 wsl host
echo "为 win 设置 wsl host"
# win hosts 文件路径
win_hosts_path="/mnt/c/Windows/System32/drivers/etc/hosts"
# 为 wsl2 设置的域名
echo "为 wsl2 设置的域名:dev.wsl.net"
wsl_domain="dev.wsl.net"
# 获取 wsl2 的 ip
wsl_ip=$(ifconfig eth0 | grep -w inet | awk '{print $2}')
echo "wsl2的ip:$wsl_ip"
# 判断是否已存在 wsl2 的域名，如果存在则修改，否则追加
if grep -wq "$wsl_domain" $win_hosts_path
then
    # 此处因为权限问题没有直接用 sed 修改 hosts 文件
    win_hosts=$(sed -s "s/.* $wsl_domain/$wsl_ip $wsl_domain/g" $win_hosts_path)
    echo "$win_hosts" > $win_hosts_path
else
    echo "$wsl_ip $wsl_domain" >> $win_hosts_path
fi

#-----------------
# 需要替换的数组域名
domainArr=(dev.host.net dev.guo.net xm.guo.net bs.guo.net xm.yougou.net bs.yougou.net api.yougou.net dev.blog.net)
# 循环
for domain in ${domainArr[@]};
do
    # 判断是否已存在 wsl2 的域名，如果存在则修改，否则追加
	if grep -wq "$domain" $win_hosts_path
	then
		# 此处因为权限问题没有直接用 sed 修改 hosts 文件
		win_hosts=$(sed -s "s/.* $domain/$wsl_ip $domain/g" $win_hosts_path)
		echo "$win_hosts" > $win_hosts_path
	else
		echo "$wsl_ip $domain" >> $win_hosts_path
	fi
done
#-----------------

# 为 wsl 设置 win host
wsl_hosts_path="/etc/hosts"
win_domain="dev.win.net"
win_ip=$(cat /etc/resolv.conf | grep "nameserver" | awk '{print $2}')
if grep -wq "$win_domain" $wsl_hosts_path
then
    wsl_hosts=$(sed -s "s/.* $win_domain/$win_ip $win_domain/g" $wsl_hosts_path)
    echo $wsl_hosts > $wsl_hosts_path
else
    echo "$win_ip $win_domain" >> $wsl_hosts_path
fi
```

#### 宝塔 mysql 外网 root 无法连接

[宝塔 mysql 外网 root 无法连接](https://www.choudalao.com/article/304 "宝塔 mysql 外网 root 无法连接")

#### 通过远程ip连接wsl中的服务
在wsl子系统中，使用以下命令，获取wsl的ip
```go
ip addr | grep eth0
```
在windows中，用管理员方式打开powershell，输入命令，这里我的wsl的ip为172.23.186.3，要启动服务的端口为30000，因此命令如下
```go
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=30000 connectaddress=172.23.186.3 connectport=30000
```
记得在使用的时候，替换 connectaddress 和 listenport、connectport 为你需要的值。

*connectaddress:wsl的ip
connectport：wsl的端口
listenport：win端口*

##### 查看当前的端口映射
```go
netsh interface portproxy show all
```
##### 删除这个端口映射
```go
netsh interface portproxy delete v4tov4 listenport=1234 listenaddress=0.0.0.0
```

#### nginx + php-fpm 打开速度缓慢
找到 `nginx.conf`,配置如下:
```go

http {
    fastcgi_buffering off;
	// 其他代码
}
```