---
title: "mysql和php字符长度判断"
date: 2020-04-29T17:03:26+08:00
updated: 2026-02-23T16:21:49+08:00
author: "臭大佬"
categories: [MYSQL]
description: "mysql和php字符长度判断"
cover: "https://www.choudalao.com/uploads/20200429/FXEG6t7mwrQVo75e9mkNc2gFqHhN4m1V8GLpF3xX.jpeg"
click: 3481
---

# 问题
最近工作中遇到一个问题，数据库字段设置的`varchar(255)`，测试测的时候总是在临界点那边给我提bug，今天研究一下mysql和php字符长度判断。

# 环境
php7.2.9
mysql8.0.12
测试时文件的编码方式要是UTF8
数据库字段类型大小为 varchar(255)，php中用strlen()与mb_strlen()函数。

## 注意
需要注意的是，mb_strlen并不是PHP核心函数，使用前需要确保在php.ini中加载了php_mbstring.dll，即确保
“extension=php_mbstring.dll”这一行存在并且没有被注释掉，否则会出现未定义函 数的问题。

# 分析
考虑到汉字的特殊性，我们测试主要分为两种，一个是纯汉字，一个是纯英文字母。
### 纯汉字
准备一个255个汉字的字符串，然后提交数据库查看结果。
```php
//255个汉字
这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个汉字的句子这是个十个
```
#### php函数的结果
我们在提交前，看一下这两个php函数分别返回的值是多少
```php
dd(strlen($this->beizhu),mb_strlen($this->beizhu,'UTF8') );
```
###### 结果
![](https://www.choudalao.com/uploads/20200429/20200429165741CaGVZe.png)

可以看出mb_strlen($this->beizhu,'UTF8')，是我们要的结果。

#### 提交到数据库
提交后发现可以成功保存：
![](https://www.choudalao.com/uploads/20200429/20200429170744c1MrCJ.png)
我们把加一个汉字，继续提交，结果如下：
```php
SQLSTATE[22001]: String data, right truncated: 1406 Data too long for column 'remark' at row 1 
```
此时数据库报错了。
所以，该环境下varchar(255)，可以存的汉字数是255个。

### 纯字母
我们以同样的方式测试字母,首先准备255个字母的字符串。
```php
// 255个字母
ABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDE
```
#### php函数的结果
我们在提交前，看一下这两个php函数分别返回的值是多少
```php
dd(strlen($this->beizhu),mb_strlen($this->beizhu,'UTF8') );
```
###### 结果
![](https://www.choudalao.com/uploads/20200429/20200429170218QX6Rfr.png)
字母的情况下，php的strlen和mb_strlen($str,'UTF8')得到的结果一样，都是返回255.

#### 提交到数据库
测试是可以保存的，我们再往里面加个字母，可以发现报同样的错误。

# 结论
#### php在判断字段长度的时候用`mb_strlen($str,'UTF8')`，可以得到和我们输入字符一样的结果。
计算时，选定内码为UTF8，则会将一个中文字符当作长度1来计算，所以“中文a字1符”长度是6 ，虽然上面函数可以简单解决一些中英文混合问题，但是不能用于实际中，下面我来给各位朋友介绍其它比较好的办法。PHP获取中英文混合字符串长度的实现代码如下,1中文=1位，2英文=1位，可自行修改。

```php
mb_strlen($str,'UTF8')
```
#### 高版本 MySQL 中的 VARCHAR(255) 可以存放 1 - 255 个 UTF-8 格式的字符。