---
title: "PHP 的运行模式"
date: 2021-09-24T14:59:07+08:00
updated: 2026-02-23T15:16:54+08:00
author: "臭大佬"
categories: [php]
description: "PHP 的运行模式"
cover: "https://www.choudalao.com/images/config/default-img.jpg"
click: 3134
---

## Model方式
`PHP Module`加载方式,就是把`php`作为`apache`的一个子模块运行.当通过`web`访问php文件时,`apache`就会调用`php5_module`来解析`php`代码。

`php5_module` 通过`sapi`将数据传给`php`解析器解析`php`代码。

![](https://www.choudalao.com/uploads/20210924/20210924144826g5CKgE.png)

`apache`每接收一个请求，都会产生一个进程来连接`php`通过`sapi`来完成请求，如果一旦用户过多，并发数过多，服务器就会承受不住了。

而且，把`mod_php`编进`apache`时，出问题时很难定位是`php`的问题还是`apache`的问题。

## CGI

早期的`web`服务器,只能处理用户请求的静态资源如`html`,并将存储在服务器端的静态资源返回给浏览器,由于`web`服务器不能处理动态脚本(`php`),无法实现数据互通,为了解决此问题出现了`CGI`（Common Gateway Interface）全称是”通用网关接口”,其实就是`web`服务器(中间件)与动态语言进行”交流”的协议(约定)。

`CGI`的好处就是完全独立于任何服务器，仅仅是做为中间分子。提供接口给`apache`和`php`。他们通过`cgi`搭线来完成数据传递。这样做的好处了尽量减少2个的关联，使他们2变得更独立。

 `Web`服务器会传`url`,查询字符串,`post`数据,`HTTP headers`给`php`解析器,但是`cgi`在高并发时效率会很低.因为`web`服务器遇到动态请求时,服务器会`fork`一个新的进程启动`CGI`程序,解析动态脚本语言,将结果返回给`web`服务器,`web`服务器返回给客户端,处理完成后`fork`的进程关闭,之后用户每次请求动态脚本语言都是这样一个复杂的过程,其效率可想而知。
 
##  Fastcgi
为了解决`web`服务器每接收一个动态请求都`fork`一个进程，结束`kill`掉这个进程的问题，便出现了`CGI`的改良版--`Fast-CGI`（Fast Common GatewayInterface／FastCGI）快速通用网关接口。

 Fast-CGI每次处理完请求后，不会kill掉这个进程，而是保留这个进程，从而使服务器可以同时处理更多的网页请求。这样就会大大的提高效率。


`PHP-CGI`：是 `PHP` （Web Application）对 `Web Server` 提供的 `CGI` 协议的接口程序。 同时是`PHP`自带的`Fast-CGI`管理器，性能差，很麻烦不人性化，`PHP-FPM`的出现优化了`PHP-CGI`。

`PHP-FPM`：是` PHP`（Web Application）对 `Web Server` 提供的 `FastCGI` 协议的接口程序，额外还提供了相对智能一些任务管理.`PHP-FPM`是`Fast-cgi`的进程管理器,是`FastCGI`的一个具体实现，监听`9000`端口。

包含了`master`和`worker`进程，其中`master`进程负责与`web`服务器中间件进行通信,接收用户请求,此请求服务器按照`Fast-CGI`转换,交给`worker`进程处理,执行`php`代码。

![](https://www.choudalao.com/uploads/20210924/20210924145710aAJNRm.png)

## php-cli
php-cli模式属于命令行模式,不需要借助其他程序,直接输入php xx.php 就能执行php代码。
命令行模式和常规web模式明显不一样的是:
- 没有超时时间
- 默认关闭buffer缓冲
- STDIN和STDOUT标准输入/输出/错误 的使用
- echo var_dump,phpinfo等输出直接输出到控制台
- 可使用的类/函数 不同
- php.ini配置的不同