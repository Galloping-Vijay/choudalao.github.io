<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>laravel前后端分离笔记一 - 臭大佬博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="laravel前后端分离笔记">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="臭大佬博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">臭大佬博客</div>
					
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">菜单</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">首页</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">归档</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">关于</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">laravel前后端分离笔记一</h1>
			
		</header>
		<div class="content post__content clearfix">
			<h1 id="起因">起因</h1>
<p>最近有个高防的项目需要使用前后端分离去做，这一块我觉得很有必要做一下笔记，因为后期，我的laravel-wjfcms这个系统也想采用这种前后端分离的形式去弄。</p>
<h1 id="优势">优势</h1>
<h4 id="可以实现真正的前后端解耦">可以实现真正的前后端解耦</h4>
<p>术业有专攻，前端可以专注于前端的事，后端就专心研究后端的技术，我就在这吃了大亏。前段时间写前端页面快把我给写挂了。希望后端以后再也不用写那些js和css了，太难了。
前端页面渲染，然后以接口的形式获取数据，这样，后端的可扩展性就很强了，比如博主最近在学习Go，如果是前后端分离的话，后期我就可以直接用Go去作为接口返回数据给前端页面了，不需要重写整个项目。</p>
<h1 id="初始化项目">初始化项目</h1>
<h4 id="拉取项目">拉取项目</h4>
<p>我们打开<code>E:\wwwroot\laravel\dev.lar.net</code>目录,这是我放置代码的目录，根据自己需求配置，使用composer拉取</p>
<pre tabindex="0"><code>composer create-project --prefer-dist laravel/laravel blog
</code></pre><p><code>.env.example</code> 复制一份命名为<code>.env</code>，然后设置一下数据库连接。</p>
<p>设置项目key</p>
<pre tabindex="0"><code> php artisan key:generate
</code></pre><p>编辑项目下的数据迁移文件，添加我们需要的字段</p>
<pre tabindex="0"><code>//2014_10_12_000000_create_users_table.php
/**
    * Run the migrations.
    *
    * @return void
    */
   public function up()
   {
       Schema::create(&#39;users&#39;, function (Blueprint $table) {
           $table-&gt;bigIncrements(&#39;id&#39;)-&gt;comment(&#39;用户表&#39;);
           $table-&gt;string(&#39;name&#39;)-&gt;comment(&#39;用户昵称&#39;);
           $table-&gt;text(&#39;last_token&#39;)-&gt;comment(&#39;登陆时的token&#39;);
           $table-&gt;tinyInteger(&#39;status&#39;)-&gt;default(&#39;0&#39;)-&gt;comment(&#39;用户状态 -1代表已删除 0代表正常 1代表冻结&#39;);
           $table-&gt;string(&#39;email&#39;,150)-&gt;unique();
           $table-&gt;timestamp(&#39;email_verified_at&#39;)-&gt;nullable();
           $table-&gt;string(&#39;password&#39;);
           $table-&gt;rememberToken();
           $table-&gt;timestamps();
       });
   }
</code></pre><p><img src="https://www.choudalao.com/uploads/20191115/20191115103951PxKS6q.png" alt=""></p>
<h5 id="注意数据迁移文件有uniques的字段都需要设置长度不然会报如下错误">注意，数据迁移文件有uniques()的字段都需要设置长度，不然会报如下错误：</h5>
<p><img src="https://www.choudalao.com/uploads/20191115/20191115104139Wn2wSm.png" alt=""></p>
<p><img src="https://www.choudalao.com/uploads/20191115/20191115104148vsSYuG.png" alt=""></p>
<p>每个问价都打开设置后再运行 <code>php artisan migrate</code></p>
<p><img src="https://www.choudalao.com/uploads/20191115/201911151042229kRntU.png" alt=""></p>
<p>然后把blog里面的内容剪切到dev.lar.net目录下，再删除blog。
<img src="https://www.choudalao.com/uploads/20191115/20191115110801S3aCM1.png" alt=""></p>
<p>#配置网站</p>
<p>我本地用的是phpstudy配置，如果您也是使用这个配置环境的话，可以参考我这篇进行配置 <a href="https://www.choudalao.com/article/55" title="phpStudy+nginx配置laravel伪静态">phpStudy+nginx配置laravel伪静态</a></p>
<p>#模型</p>
<p>然后把app目录下的User.php移动到Models目录下
运行如下命令，生成User模型:</p>
<pre tabindex="0"><code>php artisan make:model /Models/User
</code></pre><p><img src="https://www.choudalao.com/uploads/20191115/20191115104410i3b9PC.png" alt=""></p>
<p>然后把app/User.php文件内容复制到新建的Models/User内，修改命名空间为<code>namespace App\Models; //这里从App改成了App\Models</code></p>
<p><img src="https://www.choudalao.com/uploads/20191115/20191115104608VeBdZi.png" alt=""></p>
<p>最后文件<code>/Models/User.php</code>代码 如下：</p>
<pre tabindex="0"><code>&lt;?php
namespace App\Models; //这里从App改成了App\Models

use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;

class User extends Authenticatable
{
   use Notifiable;

   /**
    * The attributes that are mas assignable.
    *
    * @var array
    */
   protected $fillable = [
       &#39;name&#39;, &#39;email&#39;, &#39;password&#39;,&#39;last_token&#39;
   ];

   /**
    * The attributes that should be hidden for arrays.
    *
    * @var array
    */
   protected $hidden = [
       &#39;password&#39;, &#39;remember_token&#39;,
   ];

   /**
    * The attributes that should be cast to native types.
    *
    * @var array
    */
   protected $casts = [
       &#39;email_verified_at&#39; =&gt; &#39;datetime&#39;,
   ];

   /**
    * Description:将密码进行加密
    * User: Vijay &lt;1937832819@qq.com&gt;
    * Date: 2019/11/15
    * Time: 10:49
    * @param $value
    */
   public function setPasswordAttribute($value)
   {
       $this-&gt;attributes[&#39;password&#39;] = bcrypt($value);
   }
}
</code></pre><p>查找项目中的<code>App\User</code>进行替换<code>App\Models\User</code></p>
<p><img src="https://www.choudalao.com/uploads/20191115/20191115105100k0w5q2.png" alt=""></p>
<h1 id="控制器">控制器</h1>
<p>首先自己创建一个放回的json格式，在<code>app/Http/Controller.php</code>加上如下方法：</p>
<pre tabindex="0"><code> /**
    * Description:
    * User: Vijay &lt;1937832819@qq.com&gt;
    * Date: 2019/11/15
    * Time: 11:53
    * @param int $code
    * @param string $msg
    * @param null $data
    * @param array $additional
    * @param array $header
    * @return \Illuminate\Contracts\Routing\ResponseFactory|\Illuminate\Http\Response
    */
   protected function resJson($code = 0, $msg = &#39;&#39;, $data = null, array $additional = [], array $header = [])
   {
       $result = [
           &#39;code&#39; =&gt; $code,
           &#39;msg&#39; =&gt; $msg,
           &#39;data&#39; =&gt; $data,
       ];
       if (count($additional) &gt; 0) {
           foreach ($additional as $key =&gt; $val) {
               $result[$key] = $val;
           }
       }
       $result[&#39;create_time&#39;] = date(&#39;Y-m-d H:i:s&#39;, time());
       return response($result)-&gt;withHeaders($header);
   }
</code></pre><p><img src="https://www.choudalao.com/uploads/20191115/20191115115734Sx45d9.png" alt=""></p>
<p>创建API控制器</p>
<pre tabindex="0"><code>php artisan make:controller Api/UserController
</code></pre><p>代码如下：</p>
<pre tabindex="0"><code>&lt;?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class UserController extends Controller
{
    /**
     * Description:
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/11/15
     * Time: 10:57
     * @param Request $request
     * @return string
     */
    public function index(Request $request)
    {
        return &#39;测试API&#39;;
    }
}
</code></pre><h1 id="路由">路由</h1>
<p>与<code>Http/Controllers/Api</code>对应的路由在<code>routes/api.php</code>里面设置，
我们给路由添加一个 prefix 是为了版本号，方便后期接口升级区分。</p>
<pre tabindex="0"><code>Route::namespace(&#39;Api&#39;)-&gt;prefix(&#39;v1&#39;)-&gt;group(function () {
    Route::get(&#39;/users&#39;,&#39;UserController@index&#39;)-&gt;name(&#39;users.index&#39;);
});
</code></pre><p>访问结果</p>
<p><img src="https://www.choudalao.com/uploads/20191115/201911151119267zorGD.png" alt=""></p>
<p>API工具访问</p>
<p><img src="https://www.choudalao.com/uploads/20191115/20191115112017WPzPaQ.png" alt=""></p>
<h1 id="创建验证器">创建验证器</h1>
<p>在创建用户之前，我们先创建验证器，来让我们服务器接收到的数据更安全。当然，我们也要把关于 Api 验证的放在一个专门的文件夹内。</p>
<p>创建一个 Request 的基类</p>
<pre tabindex="0"><code>php artisan make:request RequestPost
</code></pre><p>修改访问权限，最终文件代码如下：</p>
<pre tabindex="0"><code>&lt;?php

namespace App\Http\Requests;

use Illuminate\Contracts\Validation\Validator;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Http\Exceptions\HttpResponseException;
use Illuminate\Support\Facades\Auth;

class RequestPost extends FormRequest
{
    /**
     * @var
     * Description:
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/10/21
     * Time: 11:18
     */
    protected $msg;

    /**
     * Determine if the user is authorized to make this request.
     * 判断用户是否有权限做出此请求。
     *
     * @return bool
     */
    public function authorize()
    {
//        $user = Auth::user();
//        if ($user-&gt;is_admin) {
//            return true;
//        } else {
//            $this-&gt;getFailedResponse(&#39;该操作未经授权&#39;);
//        }
        return true;
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array
     */
    public function rules()
    {
        return [
            //
        ];
    }

    /**
     * Description:设置错误信息
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/10/21
     * Time: 11:17
     * @param $msg
     * @return $this
     */
    protected function setMsg($msg)
    {
        $this-&gt;msg = $msg;
        return $this;
    }

    /**
     * Description:返回错误相应
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/10/21
     * Time: 11:21
     * @param string $msg
     * @param int $code
     * @param null $data
     * @param int $status
     */
    protected function getFailedResponse($msg = &#39;&#39;, $code = 0, $data = null, $status = 200)
    {
        throw (new HttpResponseException(response()-&gt;json([
            &#39;code&#39; =&gt; $code,
            &#39;msg&#39; =&gt; $msg,
            &#39;data&#39; =&gt; $data
        ], $status)));
    }

    /**
     * Description:返回错误信息
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/10/16
     * Time: 16:06
     * @param Validator $validator
     */
    protected function failedValidation(Validator $validator)
    {
        $this-&gt;getFailedResponse($validator-&gt;errors()-&gt;first());
    }
}
</code></pre><p>创建关于 UserController 的专属验证器,并让它继承RequestPost基类</p>
<pre tabindex="0"><code>&lt;?php

namespace App\Http\Requests;

use Illuminate\Contracts\Validation\Validator;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Http\Exceptions\HttpResponseException;
use Illuminate\Support\Facades\Auth;

class BaseRequest extends FormRequest
{
    /**
     * @var
     * Description:
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/10/21
     * Time: 11:18
     */
    protected $msg;

    /**
     * Determine if the user is authorized to make this request.
     * 判断用户是否有权限做出此请求。
     *
     * @return bool
     */
     public function authorize()
    {
        //false代表权限验证不通过，返回403错误
        //true代表权限认证通过
        //$user = Auth::user();
        //if ($user-&gt;is_admin) {
        //  return true;
        //} else {
        //  $this-&gt;getFailedResponse(&#39;该操作未经授权&#39;);
        //}
        return true;
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array
     */
    public function rules()
    {
        return [
            //
        ];
    }

    /**
     * Description:设置错误信息
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/10/21
     * Time: 11:17
     * @param $msg
     * @return $this
     */
    protected function setMsg($msg)
    {
        $this-&gt;msg = $msg;
        return $this;
    }

    /**
     * Description:返回错误相应
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/10/21
     * Time: 11:21
     * @param string $msg
     * @param int $code
     * @param null $data
     * @param int $status
     */
    protected function getFailedResponse($msg = &#39;&#39;, $code = 0, $data = null, $status = 200)
    {
        throw (new HttpResponseException(response()-&gt;json([
            &#39;code&#39; =&gt; $code,
            &#39;msg&#39; =&gt; $msg,
            &#39;data&#39; =&gt; $data
        ], $status)));
    }

    /**
     * Description:返回错误信息
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/10/16
     * Time: 16:06
     * @param Validator $validator
     */
    protected function failedValidation(Validator $validator)
    {
       $this-&gt;getFailedResponse($validator-&gt;errors()-&gt;first());
    }
}
</code></pre><h1 id="创建数据">创建数据</h1>
<p>现在我们来编写创建用户接口，在<code>UserController</code>增加两个方法，并增加两条路由</p>
<pre tabindex="0"><code>// app/Http/Controllers/Api/UserController.php
/**
     * Description:用户注册
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/11/15
     * Time: 11:31
     * @param UserRequest $request
     * @return string
     */
    public function store(UserRequest $request)
    {
        User::create($request-&gt;all());
        return &#39;用户注册成功。。。&#39;;
    }

    /**
     * Description:用户登录
     * User: Vijay &lt;1937832819@qq.com&gt;
     * Date: 2019/11/15
     * Time: 11:32
     * @param Request $request
     * @return string
     */
    public function login(Request $request)
    {
        $res = Auth::guard(&#39;web&#39;)-&gt;attempt([&#39;name&#39; =&gt; $request-&gt;name, &#39;password&#39; =&gt; $request-&gt;password]);
        if ($res) {
            return &#39;用户登录成功...&#39;;
        }
        return &#39;用户登录失败&#39;;
    }
</code></pre><pre tabindex="0"><code>Route::namespace(&#39;Api&#39;)-&gt;prefix(&#39;v1&#39;)-&gt;group(function () {
    Route::get(&#39;/users&#39;,&#39;UserController@index&#39;)-&gt;name(&#39;users.index&#39;);

    Route::post(&#39;/users&#39;,&#39;UserController@store&#39;)-&gt;name(&#39;users.store&#39;);
    Route::post(&#39;/login&#39;,&#39;UserController@login&#39;)-&gt;name(&#39;users.login&#39;);
});
</code></pre><p>用API工具添加数据</p>
<p><img src="https://www.choudalao.com/uploads/20191115/20191115123914R0tpRc.png" alt=""></p>

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2026 臭大佬博客.
			<span class="footer__copyright-credits">基于 <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> 引擎和 <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> 主题</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>