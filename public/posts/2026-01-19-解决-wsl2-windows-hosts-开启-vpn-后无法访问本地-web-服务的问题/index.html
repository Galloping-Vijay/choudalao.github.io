<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>解决 WSL2 + Windows Hosts + 开启 VPN 后无法访问本地 Web 服务的问题 - 臭大佬博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="解决 WSL2 + Windows Hosts + 开启 VPN 后无法访问本地 Web 服务的问题"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/choudalao.github.io/css/style.css><link rel="shortcut icon" href=/choudalao.github.io/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/choudalao.github.io/ title=臭大佬博客 rel=home><div class="logo__item logo__text"><div class=logo__title>臭大佬博客</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/choudalao.github.io/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/posts/><span class=menu__text>归档</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>解决 WSL2 + Windows Hosts + 开启 VPN 后无法访问本地 Web 服务的问题</h1></header><div class="content post__content clearfix"><h2 id=问题>问题</h2><blockquote><p><strong>场景描述</strong>：</p><ul><li>你在 <strong>WSL2 中运行了一个 Web 服务（如 Nginx、Go、Php、Node.js 等）</strong>。</li><li>在 <strong>Windows 的 <code>hosts</code> 文件中绑定了域名（如 <code>dev.wsl.net -> 172.x.x.x</code>）</strong>，以便在 Windows 浏览器中访问该服务。</li><li><strong>不开 VPN 时一切正常</strong>，但一旦开启公司或个人的 <strong>全流量接管型 VPN</strong>，Windows 就无法解析该域名，导致页面打不开。</li></ul></blockquote><p>本文将详细介绍这个问题的原因，并提供一个简单有效的解决方案：<strong>使用 <code>.localhost</code> 域名</strong>。</p><hr><h2 id=-问题描述>🔍 问题描述</h2><h3 id=-正常情况>✅ 正常情况</h3><ul><li>WSL2 中运行的 Web 服务可以通过绑定的域名（如 <code>http://dev.wsl.net</code>）从 Windows 浏览器访问。</li><li>例如，在 Windows 的 <code>hosts</code> 文件中有如下配置：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>172.28.123.45 dev.wsl.net
</span></span></code></pre></div></li></ul><h3 id=-开启-vpn-后>❌ 开启 VPN 后</h3><ul><li>开启公司或个人的 <strong>全流量接管型 VPN</strong> 后，尝试访问 <code>http://dev.wsl.net</code> 会失败，提示“无法访问此网站”或 DNS 解析失败。</li></ul><hr><h2 id=-导致问题的原因>🛠️ 导致问题的原因</h2><h3 id=1-vpn-劫持了所有-dns-请求>1. <strong>VPN 劫持了所有 DNS 请求</strong></h3><p>许多企业级或安全型 VPN（如 Cisco AnyConnect、Palo Alto GlobalProtect、OpenVPN 全隧道模式）会：</p><ul><li><strong>强制所有 DNS 查询走远程服务器</strong>；</li><li><strong>忽略或绕过本地 <code>C:\Windows\System32\drivers\etc\hosts</code> 文件</strong>；</li><li>启用 <strong>DNS over HTTPS (DoH)</strong>，进一步跳过本地解析。</li></ul><h3 id=2-结果>2. <strong>结果</strong></h3><p>当开启 VPN 后：</p><ul><li>访问 <code>dev.wsl.net</code> → 不再查 hosts → 发送 DNS 请求到远程 → 远程返回“不存在” → <strong>访问失败 ❌</strong></li></ul><hr><h2 id=-解决方案使用-localhost-域名>✅ 解决方案：使用 <code>.localhost</code> 域名</h2><p>根据 <a href=https://datatracker.ietf.org/doc/html/rfc6761>RFC 6761</a>，<strong><code>.localhost</code> 域名必须解析为回环地址，且不得通过网络 DNS 查询</strong>。因此，它不会被任何远程 DNS 或 DoH 影响。</p><h3 id=操作步骤>操作步骤：</h3><h4 id=1-修改-windows-的>1. <strong>修改 Windows 的 <code>hosts</code> 文件</strong></h4><p>以管理员身份打开 <code>C:\Windows\System32\drivers\etc\hosts</code>，将原来的：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>172.28.123.45 dev.wsl.net
</span></span></code></pre></div><p>改为：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>172.28.123.45 wsl.localhost
</span></span></code></pre></div><h4 id=2-保存文件>2. <strong>保存文件</strong></h4><h4 id=3-在-windows-浏览器中访问>3. <strong>在 Windows 浏览器中访问</strong></h4><pre tabindex=0><code>http://wsl.localhost
</code></pre><h4 id=4-现在无论是否开启-vpn都能正常访问>4. <strong>现在，无论是否开启 VPN，都能正常访问！✅</strong></h4><hr><h3 id=-验证方法>🧪 验证方法</h3><p>在开启 VPN 的状态下，在 Windows 中执行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-cmd data-lang=cmd><span style=display:flex><span>ping wsl.localhost
</span></span></code></pre></div><p>如果返回的是你的 WSL2 IP（如 <code>172.28.123.45</code>），说明解析成功 ✅<br>如果提示“找不到主机”，说明你还没改 hosts 或拼写错误 ❌</p><hr><h3 id=-注意事项>⚠️ 注意事项</h3><ol><li><p><strong>必须用 <code>.localhost</code>，不能是 <code>.local</code>、<code>.test</code> 等</strong></p><ul><li><code>.local</code> 会被 mDNS（Bonjour/Zeroconf）接管，可能不稳定；</li><li><code>.test</code> 虽也是保留域名，但部分企业 VPN 仍可能劫持；</li><li><strong>只有 <code>.localhost</code> 是 100% 强制本地解析的</strong>。</li></ul></li><li><p><strong>不要用 <code>localhost</code> 本身</strong></p><ul><li><code>localhost</code> 默认指向 <code>127.0.0.1</code>（Windows 自己），而不是 WSL2；</li><li>所以要用 <strong>子域名</strong>，如 <code>app.localhost</code>、<code>api.localhost</code>。</li></ul></li><li><p><strong>确保 WSL2 服务监听 <code>0.0.0.0</code></strong>
例如 Nginx 配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>app.localhost</span>;  <span style=color:#75715e># 可选
</span></span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></div><p>或 Node.js：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>3000</span>, <span style=color:#e6db74>&#39;0.0.0.0&#39;</span>, () =&gt; { ... })
</span></span></code></pre></div></li></ol><hr><h2 id=-总结>✅ 总结</h2><h3 id=问题-1>问题</h3><ul><li>在 WSL2 中运行的 Web 服务，通过 Windows 的 <code>hosts</code> 文件绑定域名（如 <code>dev.wsl.net -> 172.x.x.x</code>）访问。</li><li>开启全流量接管型 VPN 后，Windows 无法解析该域名，导致页面打不开。</li></ul><h3 id=导致问题的原因>导致问题的原因</h3><ul><li>开启 VPN 后，Windows 的 DNS 请求被强制走远程服务器，忽略本地 <code>hosts</code> 文件，导致域名解析失败。</li></ul><h3 id=解决方案>解决方案</h3><ul><li>使用 <code>.localhost</code> 域名代替 <code>.local</code> 或其他自定义域名。<ul><li>修改 Windows 的 <code>hosts</code> 文件，将 <code>dev.wsl.net</code> 改为 <code>wsl.localhost</code>。</li><li>在浏览器中访问 <code>http://wsl.localhost</code>。</li></ul></li></ul><h3 id=总结>总结</h3><table><thead><tr><th>问题</th><th>解决方法</th></tr></thead><tbody><tr><td>开启 VPN 后 <code>dev.wsl.net</code> 无法访问</td><td><strong>改为 <code>wsl.localhost</code> 或 <code>dev.wsl.localhost</code></strong></td></tr><tr><td>原因</td><td>VPN 劫持 DNS，绕过本地 <code>hosts</code></td></tr><tr><td>为什么 <code>.localhost</code> 有效</td><td>RFC 强制本地解析，不走 DNS</td></tr><tr><td>是否需要重启 WSL？</td><td>❌ 不需要</td></tr><tr><td>是否需要改代码？</td><td>❌ 只需改 hosts 和浏览器地址栏</td></tr></tbody></table><hr><blockquote><p>💡 <strong>一句话终极答案</strong>：<br><strong>把你的开发域名从 <code>xxx.local</code> 改成 <code>xxx.localhost</code>，并在 Windows hosts 中绑定 WSL2 IP，即可在开 VPN 时正常访问。</strong></p></blockquote><p>这是目前最简单、最可靠、兼容性最好的方案，已被无数开发者验证 ✅</p><p>试试看吧！如果有任何问题，欢迎继续交流 😊</p></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 臭大佬博客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/choudalao.github.io/js/menu.js></script></body></html>