<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Go 中实现 JWT 登录 | 臭大佬 - 臭大佬博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Go 中实现 JWT  登录"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/choudalao.github.io/css/style.css><link rel="shortcut icon" href=/choudalao.github.io/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/choudalao.github.io/ title=臭大佬博客 rel=home><div class="logo__item logo__text"><div class=logo__title>臭大佬博客</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/choudalao.github.io/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/post/><span class=menu__text>归档</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Go 中实现 JWT 登录 | 臭大佬</h1></header><div class="content post__content clearfix"><h1 id=什么是jwt>什么是JWT</h1><blockquote><p>Json web token (JWT), 是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准（(RFC 7519).该token被设计为紧凑且安全的，特别适用于分布式站点的单点登录（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。</p></blockquote><p>相信很多朋友在写后台接口的时候都有用过，最近想把博客的后端用 <code>beego</code>框架来实现，而后台模块接口都是需要登录后才能访问的，这就需要用的<code>JWT</code>了，<code>go</code>中相应的包有<code>github.com/dgrijalva/jwt-go</code>，下面简单介绍一下实现过程。</p><h4 id=本文是在-beego框架下实现的如果您用的不是beego框架逻辑是差不多的请根据具体情况修改代码>本文是在 <code>beego</code>框架下实现的，如果您用的不是<code>beego</code>框架，逻辑是差不多的，请根据具体情况修改代码。</h4><h1 id=安装扩展>安装扩展</h1><p>执行命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>dgrijalva</span><span style=color:#f92672>/</span><span style=color:#a6e22e>jwt</span><span style=color:#f92672>-</span><span style=color:#66d9ef>go</span>
</span></span></code></pre></div><p>除了<code>JWT</code>包，这里再推荐一个包<code>github.com/syyongx/php2go</code>,这个包让<code>go</code>代码敲起来像<code>php</code>，包里面实现了很多类似于<code>php</code>函数的方法，对于<code>php</code>程序员可是福音啊，敲起代码一把梭。<code>墙裂</code>推荐。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>syyongx</span><span style=color:#f92672>/</span><span style=color:#a6e22e>php2go</span>
</span></span></code></pre></div><h1 id=实现过程>实现过程</h1><p>我在 <code>mian.go</code>的init方法中引入了中间件方法，</p><p><img src=https://www.choudalao.com/uploads/20200822/20200822141827vQZZ2D.png alt></p><p><code>middlewares.Init()</code>中实现了过滤器功能，当路由进来首先会去判断是否匹配正则表达式"/api/*"，</p><p><img src=https://www.choudalao.com/uploads/20200822/202008221419552gjiFE.png alt></p><p>如果匹配成功，会去判断是否在开放路由数组中。不在的话去验证<code>token</code>,验证成功则可以返回数据，否则无法获取数据。从未实现登录验证逻辑。</p><p><img src=https://www.choudalao.com/uploads/20200822/20200822142435zZC7r5.png alt></p><h3 id=生成-token>生成 token</h3><p>生成<code>token</code>是在用户登录的时候，通过验证账号密码是否正确进行发放token。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/dgrijalva/jwt-go&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//用户登录</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>self</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>AdminController</span>) <span style=color:#a6e22e>Login</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 用户账号密码验证逻辑</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 带权限创建令牌</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>claims</span> <span style=color:#f92672>:=</span> make(<span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>MapClaims</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>claims</span>[<span style=color:#e6db74>&#34;account&#34;</span>] = <span style=color:#a6e22e>admin</span>.<span style=color:#a6e22e>Account</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>claims</span>[<span style=color:#e6db74>&#34;username&#34;</span>] = <span style=color:#a6e22e>admin</span>.<span style=color:#a6e22e>Username</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>claims</span>[<span style=color:#e6db74>&#34;tel&#34;</span>] = <span style=color:#a6e22e>admin</span>.<span style=color:#a6e22e>Tel</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>claims</span>[<span style=color:#e6db74>&#34;email&#34;</span>] = <span style=color:#a6e22e>admin</span>.<span style=color:#a6e22e>Email</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>claims</span>[<span style=color:#e6db74>&#34;exp&#34;</span>] = <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Hour</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>).<span style=color:#a6e22e>Unix</span>() <span style=color:#75715e>//2小时有效期，过期需要重新登录获取token</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>token</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>NewWithClaims</span>(<span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>SigningMethodHS256</span>, <span style=color:#a6e22e>claims</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 使用自定义字符串加密 and get the complete encoded token as a string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>tokenString</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>token</span>.<span style=color:#a6e22e>SignedString</span>([]byte(<span style=color:#e6db74>&#34;mykey&#34;</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>jsonData</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}, <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>jsonData</span>[<span style=color:#e6db74>&#34;token&#34;</span>] = <span style=color:#a6e22e>tokenString</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>jsonData</span>[<span style=color:#e6db74>&#34;id&#34;</span>] = <span style=color:#a6e22e>admin</span>.<span style=color:#a6e22e>Id</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>jsonData</span>[<span style=color:#e6db74>&#34;account&#34;</span>] = <span style=color:#a6e22e>admin</span>.<span style=color:#a6e22e>Account</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>jsonData</span>[<span style=color:#e6db74>&#34;username&#34;</span>] = <span style=color:#a6e22e>admin</span>.<span style=color:#a6e22e>Username</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>jsonData</span>[<span style=color:#e6db74>&#34;tel&#34;</span>] = <span style=color:#a6e22e>admin</span>.<span style=color:#a6e22e>Tel</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>jsonData</span>[<span style=color:#e6db74>&#34;email&#34;</span>] = <span style=color:#a6e22e>admin</span>.<span style=color:#a6e22e>Email</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 返回带token的数据</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>ResJson</span>(<span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#34;获取成功&#34;</span>, <span style=color:#a6e22e>jsonData</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><img src=https://www.choudalao.com/uploads/20200822/20200822140415o4lK9o.png alt></p><h3 id=调用>调用</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>helper</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>commons</span>.<span style=color:#a6e22e>Helper</span>{}
</span></span><span style=display:flex><span><span style=color:#a6e22e>token</span>, <span style=color:#a6e22e>e</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>helper</span>.<span style=color:#a6e22e>ParseToken</span>(<span style=color:#a6e22e>ctx</span>) <span style=color:#75715e>// ctx *context.Context</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>e</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>claims</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>token</span>.<span style=color:#a6e22e>Claims</span>.(<span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>MapClaims</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 验证失败</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=验证-token>验证 token</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Description:
</span></span></span><span style=display:flex><span><span style=color:#75715e> * User: Vijay &lt;1937832819@qq.com&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Date: 2020/08/21
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Time: 17:40
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>commons</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/astaxie/beego&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/astaxie/beego/context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/dgrijalva/jwt-go&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Helper</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> wjt token 验证
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Helper</span>) <span style=color:#a6e22e>ParseToken</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) (<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>Token</span>, <span style=color:#a6e22e>e</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>authString</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Input</span>.<span style=color:#a6e22e>Header</span>(<span style=color:#e6db74>&#34;Authorization&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>kv</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Split</span>(<span style=color:#a6e22e>authString</span>, <span style=color:#e6db74>&#34; &#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>kv</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>kv</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;Bearer&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#e6db74>&#34;AuthString无效&#34;</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>tokenString</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>kv</span>[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Parse token</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>token</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>Parse</span>(<span style=color:#a6e22e>tokenString</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>token</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>Token</span>) (<span style=color:#66d9ef>interface</span>{}, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> []byte(<span style=color:#e6db74>&#34;mykey&#34;</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ve</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>ValidationError</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ve</span>.<span style=color:#a6e22e>Errors</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>ValidationErrorMalformed</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>				<span style=color:#75715e>// That&#39;s not even a token</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ve</span>.<span style=color:#a6e22e>Errors</span><span style=color:#f92672>&amp;</span>(<span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>ValidationErrorExpired</span>|<span style=color:#a6e22e>jwt</span>.<span style=color:#a6e22e>ValidationErrorNotValidYet</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>				<span style=color:#75715e>// Token is either expired or not active yet</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#e6db74>&#34;令牌已过期或尚未激活&#34;</span>
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#75715e>// Couldn&#39;t handle this token</span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#e6db74>&#34;无法处理此令牌&#34;</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Couldn&#39;t handle this token</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#e6db74>&#34;无法处理此令牌&#34;</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>token</span>.<span style=color:#a6e22e>Valid</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#e6db74>&#34;令牌无效&#34;</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>token</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>验证通过：</p><p><img src=https://www.choudalao.com/uploads/20200822/202008222016335hWNFW.png alt></p><p>验证失败时：</p><p><img src=https://www.choudalao.com/uploads/20200822/20200822201521fAc9eX.png alt></p><p>刚接触<code>go</code>不久，实现有点lou，大神勿喷，如果有错误或者有其他优化方案,希望大神们给小弟补补课,我很乐意接受批评，互相学习。</p></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 臭大佬博客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/choudalao.github.io/js/menu.js></script></body></html>