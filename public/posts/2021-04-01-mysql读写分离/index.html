<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>mysql读写分离 - 臭大佬博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="mysql读写分离"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/choudalao.github.io/css/style.css><link rel="shortcut icon" href=/choudalao.github.io/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/choudalao.github.io/ title=臭大佬博客 rel=home><div class="logo__item logo__text"><div class=logo__title>臭大佬博客</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/choudalao.github.io/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/posts/><span class=menu__text>归档</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>mysql读写分离</h1></header><div class="content post__content clearfix"><h1 id=摘要>摘要</h1><p>读写分离，基本的原理是让主数据库处理事务性增、改、删操作（INSERT、UPDATE、DELETE），
而从数据库处理 SELECT 查询操作。 数据库复制被用来把事务性操作导致的变更同步到集群中的从数据库。
至少两台数据库服务器，可以分别设置主服务器和从服务器，对主服务器的任何操作都会同步到从服务器上</p><h3 id=原理>原理</h3><p>mysql 中有一种日志，叫做 bin 日志（二进制日志），会记录下所有修改过数据库的 sql 语句。 主从复制的原理实际是多台服务器都开启 bin 日志，然后主服务器会把执行过的sql 语句记录到 bin 日志中，之后把这个 bin 日志发给从服务器， 在从服务器再把 bin 日志中记录的 sql 语句同样的执行一遍。 这样从服务器上的数据就和主服务器相同了。</p><p>纸上得来终觉浅，还是实际操作一下。</p><h2 id=测试环境>测试环境</h2><h4 id=主服务器>主服务器</h4><p>主服务器：127.0.0.1:3333
主服务器在docker上，3306映射到本地的3333端口。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>select</span> <span style=color:#a6e22e>version</span>();
</span></span><span style=display:flex><span><span style=color:#f92672>+------------+</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>version</span>()  <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+------------+</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#ae81ff>5.7</span><span style=color:#f92672>.</span><span style=color:#ae81ff>33</span><span style=color:#f92672>-</span><span style=color:#a6e22e>log</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+------------+</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> <span style=color:#a6e22e>row</span> <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>set</span> (<span style=color:#ae81ff>0.00</span> <span style=color:#a6e22e>sec</span>)
</span></span></code></pre></div><h4 id=从服务器>从服务器</h4><p>从服务器：127.0.0.1:3306
win下本地的mysql作为从服务器。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>select</span> <span style=color:#a6e22e>version</span>();
</span></span><span style=display:flex><span><span style=color:#f92672>+------------+</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>version</span>()  <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+------------+</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#ae81ff>5.7</span><span style=color:#f92672>.</span><span style=color:#ae81ff>26</span><span style=color:#f92672>-</span><span style=color:#a6e22e>log</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+------------+</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> <span style=color:#a6e22e>row</span> <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>set</span> (<span style=color:#ae81ff>0.12</span> <span style=color:#a6e22e>sec</span>)
</span></span></code></pre></div><h1 id=配置>配置</h1><h3 id=bin-log日志的使用>bin-log日志的使用</h3><p>首先我们来认识几个与bin-log相关的MySQL命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>flush</span> <span style=color:#a6e22e>logs</span>; <span style=color:#a6e22e>会多一个最新的bin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>log日志</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>show</span> <span style=color:#a6e22e>master</span> <span style=color:#a6e22e>status</span>; <span style=color:#a6e22e>查看最后一个bin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>log日志的相关信息</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>reset</span> <span style=color:#a6e22e>master</span>; <span style=color:#a6e22e>清空所有的bin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>log日志</span>
</span></span></code></pre></div><p>这些指令等下用得着。</p><h4 id=主服务器配置>主服务器配置</h4><p><code>mysql</code>的配置文件在<code>linux</code>下文件名为<code>my.cnf</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>whereis</span> <span style=color:#a6e22e>my</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cnf</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>my</span><span style=color:#f92672>:</span> <span style=color:#f92672>/</span><span style=color:#a6e22e>etc</span><span style=color:#f92672>/</span><span style=color:#a6e22e>my</span><span style=color:#f92672>.</span><span style=color:#a6e22e>cnf</span>
</span></span></code></pre></div><p>在<code>my.cnf</code>里面加上如下代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># vim /etc/my.cnf
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>server</span><span style=color:#f92672>-</span><span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>  <span style=color:#75715e>//数据库ID号
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>log</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span><span style=color:#f92672>=</span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span>  <span style=color:#75715e>//启用二进制日志
</span></span></span><span style=display:flex><span><span style=color:#75715e>#log-bin-index=mysql-bin.index  //二进制日志名称
</span></span></span></code></pre></div><p>这里注意不要放在文件的末尾，要放在前面，即<code>[mysqld]</code>后，
<img src=https://www.choudalao.com/uploads/20210401/20210401154546N9hK4K.png alt></p><p>配置完成后，查看状态：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>#登录 mysql
</span></span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>mysql</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>hlocalhost</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>uroot</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>proot12345</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 退出
</span></span></span><span style=display:flex><span><span style=color:#75715e># \q 
</span></span></span><span style=display:flex><span><span style=color:#75715e># 登录后（mysql命令必须以;结束）
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>show</span> <span style=color:#a6e22e>master</span> <span style=color:#a6e22e>status</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>+------------------+----------+--------------+------------------+-------------------+</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>File</span>             <span style=color:#f92672>|</span> <span style=color:#a6e22e>Position</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Binlog_Do_DB</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Binlog_Ignore_DB</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Executed_Gtid_Set</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+------------------+----------+--------------+------------------+-------------------+</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span><span style=color:#f92672>.</span><span style=color:#ae81ff>000005</span> <span style=color:#f92672>|</span>      <span style=color:#ae81ff>154</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>                  <span style=color:#f92672>|</span>                   <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+------------------+----------+--------------+------------------+-------------------+</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> <span style=color:#a6e22e>row</span> <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>set</span> (<span style=color:#ae81ff>0.00</span> <span style=color:#a6e22e>sec</span>)
</span></span></code></pre></div><p>记录下File和Position两个内容，从库配置的时候会用到这个。</p><p>开启后，会生成<code>mysql-bin.*</code>文件，可以看一下存放地址</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>find</span> <span style=color:#f92672>/</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>name</span> <span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span><span style=color:#f92672>.*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span><span style=color:#a6e22e>www</span><span style=color:#f92672>/</span><span style=color:#a6e22e>server</span><span style=color:#f92672>/</span><span style=color:#a6e22e>data</span><span style=color:#f92672>/</span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span><span style=color:#f92672>.</span><span style=color:#ae81ff>000005</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span><span style=color:#a6e22e>www</span><span style=color:#f92672>/</span><span style=color:#a6e22e>server</span><span style=color:#f92672>/</span><span style=color:#a6e22e>data</span><span style=color:#f92672>/</span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span><span style=color:#f92672>.</span><span style=color:#ae81ff>000003</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span><span style=color:#a6e22e>www</span><span style=color:#f92672>/</span><span style=color:#a6e22e>server</span><span style=color:#f92672>/</span><span style=color:#a6e22e>data</span><span style=color:#f92672>/</span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span><span style=color:#f92672>.</span><span style=color:#ae81ff>000004</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span><span style=color:#a6e22e>www</span><span style=color:#f92672>/</span><span style=color:#a6e22e>server</span><span style=color:#f92672>/</span><span style=color:#a6e22e>data</span><span style=color:#f92672>/</span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span><span style=color:#f92672>.</span><span style=color:#a6e22e>index</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span><span style=color:#a6e22e>www</span><span style=color:#f92672>/</span><span style=color:#a6e22e>server</span><span style=color:#f92672>/</span><span style=color:#a6e22e>data</span><span style=color:#f92672>/</span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span><span style=color:#f92672>.</span><span style=color:#ae81ff>000001</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span><span style=color:#a6e22e>www</span><span style=color:#f92672>/</span><span style=color:#a6e22e>server</span><span style=color:#f92672>/</span><span style=color:#a6e22e>data</span><span style=color:#f92672>/</span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span><span style=color:#f92672>.</span><span style=color:#ae81ff>000002</span>
</span></span></code></pre></div><h4 id=从服务器配置>从服务器配置</h4><p>理论配置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>log</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql</span><span style=color:#f92672>-</span><span style=color:#a6e22e>bin</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server</span><span style=color:#f92672>-</span><span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p>我从服务器是<code>win10</code>的<code>phpstudy</code>，在<code>phpstudy</code>可以直接配置：</p><p><img src=https://www.choudalao.com/uploads/20210401/20210401162034hH3VYc.png alt>
配置完成后查看<code>my.ini</code>文件
<img src=https://www.choudalao.com/uploads/20210401/20210401162208H1c1la.png alt></p><h4 id=关联主从库>关联主从库</h4><p>登录从库的MySQL命令行，执行以下代码，主要是关联主库的一些信息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>change</span> <span style=color:#a6e22e>master</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>master_host</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;127.0.0.1&#39;</span>, <span style=color:#75715e>#Master 服务器Ip
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>master_port</span><span style=color:#f92672>=</span><span style=color:#ae81ff>3333</span>,
</span></span><span style=display:flex><span><span style=color:#a6e22e>master_user</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;root&#39;</span>,
</span></span><span style=display:flex><span><span style=color:#a6e22e>master_password</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;root12345&#39;</span>, 
</span></span><span style=display:flex><span><span style=color:#a6e22e>master_log_file</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;mysql-bin.000005&#39;</span>,  <span style=color:#75715e>#Master日志文件名
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>master_log_pos</span><span style=color:#f92672>=</span><span style=color:#ae81ff>154</span>; <span style=color:#75715e>#Master日志同步开始位置
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>Query</span> <span style=color:#a6e22e>OK</span>, <span style=color:#ae81ff>0</span> <span style=color:#a6e22e>rows</span> <span style=color:#a6e22e>affected</span> (<span style=color:#ae81ff>0.08</span> <span style=color:#a6e22e>sec</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># `master_log_file`和`master_log_pos`是刚才执行`show master status;`的两个值。
</span></span></span></code></pre></div><p><img src=https://www.choudalao.com/uploads/20210401/20210401164516f7eKV3.png alt></p><p>注意是否执行成功，如果执行失败就好好检查下代码，看看哪里写错了。
如果执行正常，就启动从库slave，并查看下连接状态。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>start</span> <span style=color:#a6e22e>slave</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>Query</span> <span style=color:#a6e22e>OK</span>, <span style=color:#ae81ff>0</span> <span style=color:#a6e22e>rows</span> <span style=color:#a6e22e>affected</span> (<span style=color:#ae81ff>0.03</span> <span style=color:#a6e22e>sec</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>mysql</span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>show</span> <span style=color:#a6e22e>slave</span> <span style=color:#a6e22e>status\G</span>; <span style=color:#75715e>//查看slave连接状态
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 在`Navicate`中命令行查询语句带`\g`或`\G`格式化显示报错，所以，我这边没有格式化，执行的是：`show slave status;`,
</span></span></span></code></pre></div><p><img src=https://www.choudalao.com/uploads/20210401/20210401170947yvDxVM.png alt></p><p>我输出的结果有点乱，但相关的信息还是可以看到的，</p><p>这两个状态必须为Yes才算成功，如果不是，则检查上面步骤那一步配置错误。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>Slave_IO_Running</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Yes</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Slave_SQL_Running</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Yes</span>
</span></span></code></pre></div><p>配置的参数文件在<code>phpstudy_pro\Extensions\MySQL5.7.26\data\master.info</code>。
查看<code>master.info</code>里面的内容：
<img src=https://www.choudalao.com/uploads/20210401/20210401171123OpaqhV.png alt></p><h1 id=问题>问题</h1><h3 id=last_io_error-master-command-com_register_slave-failed-access-denied-for-user-xxxxxx-using-password-yes-errno-1045>Last_IO_Error: Master command COM_REGISTER_SLAVE failed: Access denied for user &lsquo;xxx&rsquo;@&lsquo;xxx&rsquo; (using password: YES) (Errno: 1045)</h3><h5 id=原因>原因</h5><p>这是因为主库的账号密码错误;
<img src=https://www.choudalao.com/uploads/20220809/202208091540281f5o79.png alt>
可以在从库中测试连接:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># 以下是主库的ip和账号密码
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>mysql</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>h</span>[<span style=color:#a6e22e>ip</span>] <span style=color:#f92672>-</span><span style=color:#a6e22e>u</span>[<span style=color:#a6e22e>账号</span>] <span style=color:#f92672>-</span><span style=color:#a6e22e>p</span>[<span style=color:#a6e22e>密码</span>]
</span></span></code></pre></div><p>如果连接失败,那就是账号密码问题了.
如果是宝塔用户的root账号,是无法在外部连接的,解决方法如下:
<img src=https://www.choudalao.com/uploads/20220809/20220809154326SWCOYr.png alt></p><p><img src=https://www.choudalao.com/uploads/20220809/202208091544255nWCGv.png alt>
<img src=https://www.choudalao.com/uploads/20220809/20220809154505B8lenA.png alt></p><p>修改完在测试就可以了.</p><h3 id=last_error-error-duplicate-entry-4684533-for-key-primary-on-query-default-database-xxx-query-insert-into>Last_Error: Error &lsquo;Duplicate entry &lsquo;4684533&rsquo; for key &lsquo;PRIMARY&rsquo;&rsquo; on query. Default database: &lsquo;xxx&rsquo;. Query: &lsquo;INSERT INTO</h3><h5 id=原因-1>原因</h5><p>这是因为 <code>File</code> 和 <code>Position</code>,太久了,插入数据发生了索引冲突,
重新在主库中运行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>show</span> <span style=color:#a6e22e>master</span> <span style=color:#a6e22e>status</span>;
</span></span></code></pre></div><p><img src=https://www.choudalao.com/uploads/20220809/20220809154856r2iNdl.png alt>
拿到最新的<code>File</code> 和 <code>Position</code>,</p><p>关闭</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>stop</span> <span style=color:#a6e22e>slave</span>;
</span></span></code></pre></div><p>重新配置连接</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>change</span> <span style=color:#a6e22e>master</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>master_host</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;xxx&#39;</span>,
</span></span><span style=display:flex><span><span style=color:#a6e22e>master_port</span><span style=color:#f92672>=</span><span style=color:#a6e22e>xxx</span>,
</span></span><span style=display:flex><span><span style=color:#a6e22e>master_user</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;xxx&#39;</span>,
</span></span><span style=display:flex><span><span style=color:#a6e22e>master_password</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;xxx&#39;</span>, 
</span></span><span style=display:flex><span><span style=color:#a6e22e>master_log_file</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;xxx&#39;</span>, 
</span></span><span style=display:flex><span><span style=color:#a6e22e>master_log_pos</span><span style=color:#f92672>=</span><span style=color:#a6e22e>xxx</span>;
</span></span></code></pre></div><p>重启</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>start</span> <span style=color:#a6e22e>slave</span>;
</span></span></code></pre></div><p>查看</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>show</span> <span style=color:#a6e22e>slave</span> <span style=color:#a6e22e>status\G</span>;
</span></span></code></pre></div><p><img src=https://www.choudalao.com/uploads/20220809/20220809155121f3Xs3V.png alt></p><h3 id=mysql主从同步时slave_io_runningconnecting--slave_sql_runningyes的情况故障排除>Mysql主从同步时Slave_IO_Running：Connecting ; Slave_SQL_Running：Yes的情况故障排除</h3><p><a href=https://blog.csdn.net/mbytes/article/details/86711508 title="Mysql主从同步时Slave_IO_Running：Connecting ; Slave_SQL_Running：Yes的情况故障排除">Mysql主从同步时Slave_IO_Running：Connecting ; Slave_SQL_Running：Yes的情况故障排除</a></p><h3 id=测试>测试</h3></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 臭大佬博客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/choudalao.github.io/js/menu.js></script></body></html>