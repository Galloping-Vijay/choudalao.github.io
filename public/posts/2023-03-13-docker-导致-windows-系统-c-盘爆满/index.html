<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>docker 导致 windows 系统 C 盘爆满 - 臭大佬博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="docker 导致 windows 系统 C 盘爆满"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/choudalao.github.io/css/style.css><link rel="shortcut icon" href=/choudalao.github.io/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/choudalao.github.io/ title=臭大佬博客 rel=home><div class="logo__item logo__text"><div class=logo__title>臭大佬博客</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/choudalao.github.io/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/post/><span class=menu__text>归档</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>docker 导致 windows 系统 C 盘爆满</h1></header><div class="content post__content clearfix"><h1 id=问题>问题</h1><p>今天发现电脑C盘爆红,找了一下大文件,发现是名为<code>ext4.vhdx</code>的文件,这个是与<code>docker</code>相关的文件,由于在<code>Linux</code>中下载安装各种软件、<code>Docker Image</code>，运行多个<code>Docker Container</code> 导致C盘空间严重不足。</p><h1 id=收缩ext4vhdx文件>收缩ext4.vhdx文件</h1><h3 id=清理不必要的镜像>清理不必要的镜像</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>docker</span> <span style=color:#a6e22e>system</span> <span style=color:#a6e22e>prune</span>
</span></span></code></pre></div><h3 id=停止wsl服务>停止wsl服务</h3><p>这个很慢,还不如重启,跳过这一步</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>wsl</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>shutdown</span>
</span></span></code></pre></div><h3 id=运行diskpart释放空间>运行diskpart释放空间</h3><p>win命令行中执行, file= 换成自己的路径</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>diskpart</span>
</span></span></code></pre></div><h1 id=选择虚拟机文件执行瘦身>选择虚拟机文件执行瘦身</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#a6e22e>vdisk</span> <span style=color:#a6e22e>file</span>=<span style=color:#e6db74>&#34;C:\Users\Administrator\AppData\Local\Packages\CanonicalGroupLimited.Ubuntu20.04LTS_79rhkp1fndgsc\LocalState\ext4.vhdx&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>attach</span> <span style=color:#a6e22e>vdisk</span> <span style=color:#a6e22e>readonly</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>compact</span> <span style=color:#a6e22e>vdisk</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>detach</span> <span style=color:#a6e22e>vdisk</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>exit</span>
</span></span></code></pre></div><p>运行完可以发现释放了好大的空间。如果C盘够大,就没必要看下面的迁移了。</p><h4 id=zerofree>zerofree</h4><p>进入到 WSL2 中，运行 zerofree 将 ext4 文件系统内已经不用的块填零，但 zerofree 不能运行在已经挂载为 rw 的文件系统上，那就把文件系统挂载为 readonly 就行了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>mount</span> <span style=color:#f92672>/</span><span style=color:#a6e22e>dev</span><span style=color:#f92672>/</span><span style=color:#a6e22e>sda</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>o</span> <span style=color:#a6e22e>remount</span>,<span style=color:#a6e22e>ro</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>zerofree</span> <span style=color:#f92672>/</span><span style=color:#a6e22e>dev</span><span style=color:#f92672>/</span><span style=color:#a6e22e>sda</span>
</span></span></code></pre></div><p>运行结束后，在 Windows 下关闭 WSL2</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>wsl</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>shutdown</span>
</span></span></code></pre></div><p>再次运行diskpart释放空间步骤</p><h1 id=迁移>迁移</h1><p>当然,如果C盘比较小,想迁移到别的盘也是可以的</p><h3 id=查看wsl实例>查看WSL实例</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>wsl</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>l</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>v</span>
</span></span></code></pre></div><ul><li>NAME STATE VERSION</li><li>Ubuntu-20.04 Stopped 2*
我只安装了一个WSL2的实例，名为Ubuntu-20.04</li></ul><h3 id=将现有wsl2实例备份导出>将现有WSL2实例备份导出：</h3><p>导出到D盘下，命名为buntu-20.04_bak.tar.tar</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>wsl</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>export</span> <span style=color:#a6e22e>Ubuntu</span><span style=color:#f92672>-</span><span style=color:#ae81ff>20.04</span> <span style=color:#a6e22e>D</span>:<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#a6e22e>Ubuntu</span><span style=color:#f92672>-</span><span style=color:#ae81ff>20.04</span><span style=color:#a6e22e>_bak</span>.<span style=color:#a6e22e>tar</span>
</span></span></code></pre></div><h3 id=备份完成后可以注销现有实例>备份完成后可以注销现有实例</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span>	<span style=color:#a6e22e>wsl</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>unregister</span> <span style=color:#a6e22e>Ubuntu</span><span style=color:#f92672>-</span><span style=color:#ae81ff>20.04</span>
</span></span></code></pre></div><h3 id=指定存放虚拟磁盘镜像文件的路径>指定存放虚拟磁盘镜像文件的路径</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span>	<span style=color:#a6e22e>wsl</span> <span style=color:#f92672>--</span><span style=color:#f92672>import</span> <span style=color:#a6e22e>Ubuntu_new</span> <span style=color:#a6e22e>D</span>:<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#a6e22e>WSL_Ubuntu</span> <span style=color:#a6e22e>D</span>:<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#a6e22e>Ubuntu</span><span style=color:#f92672>-</span><span style=color:#ae81ff>20.04</span><span style=color:#a6e22e>_bak</span>.<span style=color:#a6e22e>tar</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>version</span> <span style=color:#ae81ff>2</span>
</span></span></code></pre></div><blockquote><p>Ubuntu_new
· 实例名称，可以自己设置，设置后即为第2步输入wsl -l -v后显示的名称；
D:\WSL_Ubuntu
· 导入后的镜像及其相关数据存放路径；
D:\Ubuntu-20.04_bak.tar
· 导入的备份，即第3步通过wsl &ndash;export导出的文件；
–version 2
· WSL版本为2</p></blockquote><h3 id=设置默认登录用户>设置默认登录用户</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>ubuntu</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>--</span><span style=color:#66d9ef>default</span><span style=color:#f92672>-</span><span style=color:#a6e22e>user</span> <span style=color:#a6e22e>root</span>
</span></span></code></pre></div></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 臭大佬博客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/choudalao.github.io/js/menu.js></script></body></html>