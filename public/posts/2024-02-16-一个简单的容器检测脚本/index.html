<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>一个简单的容器检测脚本 - 臭大佬博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="一个简单的容器检测脚本">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="臭大佬博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">臭大佬博客</div>
					
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">菜单</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">首页</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">归档</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">关于</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">一个简单的容器检测脚本</h1>
			
		</header>
		<div class="content post__content clearfix">
			<h1 id="代码">代码</h1>
<h3 id="imtimersh定时器检测">imTimer.sh:定时器检测</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>!<span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">while</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">do</span>
</span></span><span style="display:flex;"><span>	<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">检测脚本</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">restart</span>.<span style="color:#a6e22e">sh</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sleep</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">done</span>
</span></span></code></pre></div><h3 id="restartsh检测和重启代码">restart.sh:检测和重启代码</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>!<span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">env</span>=<span style="color:#e6db74">&#34;prod&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">httpUrl</span>=<span style="color:#e6db74">&#34;http://127.0.0.1:3200/system/state&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">项目</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">objName</span>=<span style="color:#e6db74">&#34;im&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">设置镜像名</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">imagesName</span>=<span style="color:#e6db74">&#34;${objName}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">containerName</span>=<span style="color:#960050;background-color:#1e0010">$</span>{<span style="color:#a6e22e">objName</span>}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">当前时间</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">currentTime</span>=<span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#a6e22e">date</span> <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;%Y%m%d%H%M%S&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">检测容器是否可以访问</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">response</span>=<span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#a6e22e">curl</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">write</span><span style="color:#f92672">-</span><span style="color:#a6e22e">out</span> <span style="color:#f92672">%</span>{<span style="color:#a6e22e">http_code</span>} <span style="color:#f92672">--</span><span style="color:#a6e22e">silent</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">output</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">dev</span><span style="color:#f92672">/</span><span style="color:#a6e22e">null</span> <span style="color:#960050;background-color:#1e0010">$</span>{<span style="color:#a6e22e">httpUrl</span>})
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">查看进程是否存在</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">exist</span>=<span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">inspect</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">format</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>{{.<span style="color:#a6e22e">State</span>.<span style="color:#a6e22e">Running</span>}}<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#960050;background-color:#1e0010">$</span>{<span style="color:#a6e22e">containerName</span>})
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span> <span style="color:#e6db74">&#34;时间 ${currentTime}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span> <span style="color:#e6db74">&#34;容器 ${containerName} 状态:${exist}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span> <span style="color:#e6db74">&#34;地址 ${httpUrl}  状态:${response}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> [ <span style="color:#e6db74">&#34;${exist}&#34;</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;true&#34;</span> ] <span style="color:#f92672">||</span> [ <span style="color:#e6db74">&#34;$response&#34;</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">ne</span> <span style="color:#ae81ff">200</span> ]; <span style="color:#a6e22e">then</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span> <span style="color:#e6db74">&#34;容器 ${containerName} 执行重启&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">start</span> <span style="color:#960050;background-color:#1e0010">$</span>{<span style="color:#a6e22e">containerName</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">logFile</span>=<span style="color:#960050;background-color:#1e0010">$</span>{<span style="color:#a6e22e">containerName</span>}<span style="color:#f92672">-</span><span style="color:#e6db74">&#34;${currentTime}&#34;</span>.<span style="color:#a6e22e">log</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span> <span style="color:#e6db74">&#34;写入 ${logFile} 日志&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">logs</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> <span style="color:#960050;background-color:#1e0010">$</span>{<span style="color:#a6e22e">containerName</span>} &gt; <span style="color:#f92672">/</span><span style="color:#a6e22e">wwwlogs</span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">$</span>{<span style="color:#a6e22e">objName</span>}<span style="color:#f92672">/</span><span style="color:#a6e22e">temp</span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">$</span>{<span style="color:#a6e22e">logFile</span>} <span style="color:#f92672">&amp;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fi</span>
</span></span></code></pre></div><h3 id="执行">执行</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">nohup</span> <span style="color:#a6e22e">imTimer</span>.<span style="color:#a6e22e">sh</span> <span style="color:#f92672">&amp;</span>
</span></span></code></pre></div><h3 id="查看和杀死进程">查看和杀死进程</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">pgrep</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> <span style="color:#a6e22e">imTimer</span>.<span style="color:#a6e22e">sh</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span> <span style="color:#a6e22e">kill</span> &lt;<span style="color:#a6e22e">PID</span>&gt;
</span></span></code></pre></div><h5 id="查看占用高的进程">查看占用高的进程</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">top</span>
</span></span></code></pre></div><h5 id="查看是哪个程序">查看是哪个程序</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">ps</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">ef</span> | <span style="color:#a6e22e">grep</span> &lt;<span style="color:#a6e22e">PID</span>&gt;
</span></span></code></pre></div>
		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2026 臭大佬博客.
			<span class="footer__copyright-credits">基于 <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> 引擎和 <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> 主题</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>