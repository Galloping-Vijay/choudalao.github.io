<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>利用kind在WIN10 WSL2 中搭建 K8s 环境 - 臭大佬博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="在 WIN10 WSL2 中搭建 K8s 环境"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/choudalao.github.io/css/style.css><link rel="shortcut icon" href=/choudalao.github.io/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/choudalao.github.io/ title=臭大佬博客 rel=home><div class="logo__item logo__text"><div class=logo__title>臭大佬博客</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/choudalao.github.io/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/posts/><span class=menu__text>归档</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>利用kind在WIN10 WSL2 中搭建 K8s 环境</h1></header><div class="content post__content clearfix"><p>利用<code>kind</code>在<code>WIN10</code> <code>WSL2</code> 中搭建 <code>K8s</code> 环境</p><h2 id=安装kubectl>安装kubectl</h2><p>在<code>Ubuntu</code>上安装<code>kubectl</code>，您可以按照以下步骤进行操作：
打开终端，并使用以下命令下载kubectl的最新版本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>curl</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>LO</span> <span style=color:#e6db74>&#34;https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl&#34;</span>
</span></span></code></pre></div><p>接下来，将<code>kubectl</code>二进制文件移动到<code>goPath</code>目录下，并为其添加可执行权限：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>sudo</span> <span style=color:#a6e22e>mv</span> .<span style=color:#f92672>/</span><span style=color:#a6e22e>kubectl</span> <span style=color:#f92672>/</span><span style=color:#a6e22e>www</span><span style=color:#f92672>/</span><span style=color:#a6e22e>wwwroot</span><span style=color:#f92672>/</span><span style=color:#66d9ef>go</span><span style=color:#f92672>/</span><span style=color:#a6e22e>goPath</span><span style=color:#f92672>/</span><span style=color:#a6e22e>bin</span><span style=color:#f92672>/</span><span style=color:#a6e22e>kubectl</span>
</span></span></code></pre></div><p>验证<code>kubectl</code>是否正确安装。运行以下命令来检查<code>kubectl</code>的版本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>version</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>client</span>
</span></span></code></pre></div><p>如果<code>kubectl</code>安装成功，您将看到与<code>kubectl</code>相关的版本信息。</p><h1 id=kind安装>kind安装</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>curl</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>Lo</span> .<span style=color:#f92672>/</span><span style=color:#a6e22e>kind</span> <span style=color:#a6e22e>https</span>:<span style=color:#75715e>//kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>chmod</span> <span style=color:#f92672>+</span><span style=color:#a6e22e>x</span> .<span style=color:#f92672>/</span><span style=color:#a6e22e>kind</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>sudo</span> <span style=color:#a6e22e>mv</span> .<span style=color:#f92672>/</span><span style=color:#a6e22e>kind</span> <span style=color:#f92672>/</span><span style=color:#a6e22e>www</span><span style=color:#f92672>/</span><span style=color:#a6e22e>wwwroot</span><span style=color:#f92672>/</span><span style=color:#66d9ef>go</span><span style=color:#f92672>/</span><span style=color:#a6e22e>goPath</span><span style=color:#f92672>/</span><span style=color:#a6e22e>bin</span>
</span></span></code></pre></div><p>如果遇到错误<code>kind: command not found</code>查看<code>go</code>是否安装可执行文件<code>ls $GOPATH/bin</code></p><p>如果有<code>kind</code>,检查你的系统的 PATH 环境变量是否包含了 <code>$GOPATH/bin</code>目录。你可以在终端中执行以下命令来确认
<code>echo $PATH</code>不存在则执行<code>export PATH=$PATH:$GOPATH/bin</code></p><h4 id=再次执行kind如果不生效执行如下>再次执行<code>kind</code>,如果不生效,执行如下：</h4><p><code>source ~/.bashrc</code></p><p>注意:当<code>.bashrc</code>配置错会导致基础命令无法使用,如执行<code>ls</code>报<code>Command 'ls' is available in '/bin/ls'</code>,这时需要执行<code>export PATH=/usr/bin:bin</code></p><h3 id=创建集群>创建集群</h3><p>在<code>docker</code>启动的情况下执行:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kind</span> <span style=color:#a6e22e>create</span> <span style=color:#a6e22e>cluster</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>name</span> <span style=color:#a6e22e>tsk8s</span>
</span></span></code></pre></div><p>根据配置文件创建</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kind</span> <span style=color:#a6e22e>create</span> <span style=color:#a6e22e>cluster</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>name</span> <span style=color:#a6e22e>tsk8s</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>config</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>-</span><span style=color:#a6e22e>ingress</span>.<span style=color:#a6e22e>yaml</span>
</span></span></code></pre></div><p><code>kind-ingress.yaml</code> 文件如下:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kind</span>: <span style=color:#a6e22e>Cluster</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>apiVersion</span>: <span style=color:#a6e22e>kind</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>-</span><span style=color:#a6e22e>k8s</span>.<span style=color:#a6e22e>io</span><span style=color:#f92672>/</span><span style=color:#a6e22e>v1alpha4</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span>: <span style=color:#a6e22e>ingress</span><span style=color:#f92672>-</span><span style=color:#a6e22e>test</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>nodes</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> <span style=color:#a6e22e>role</span>: <span style=color:#a6e22e>control</span><span style=color:#f92672>-</span><span style=color:#a6e22e>plane</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>image</span>: <span style=color:#a6e22e>kindest</span><span style=color:#f92672>/</span><span style=color:#a6e22e>node</span>:<span style=color:#a6e22e>v1</span><span style=color:#ae81ff>.26.3</span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>sha256</span>:<span style=color:#ae81ff>61</span><span style=color:#a6e22e>b92f38dff6ccc29969e7aa154d34e38b89443af1a2c14e6cfbd2df6419c66f</span> <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>指定</span> <span style=color:#a6e22e>Kubernetes</span> <span style=color:#a6e22e>的版本</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>kubeadmConfigPatches</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>-</span> |
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kind</span>: <span style=color:#a6e22e>InitConfiguration</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>nodeRegistration</span>:
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>kubeletExtraArgs</span>:
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>node</span><span style=color:#f92672>-</span><span style=color:#a6e22e>labels</span>: <span style=color:#e6db74>&#34;ingress-ready=true&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>extraPortMappings</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>-</span> <span style=color:#a6e22e>containerPort</span>: <span style=color:#ae81ff>80</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>节点端口</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>hostPort</span>: <span style=color:#ae81ff>81</span>  <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>主机端口</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>: <span style=color:#a6e22e>TCP</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>-</span> <span style=color:#a6e22e>containerPort</span>: <span style=color:#ae81ff>443</span> <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>节点端口</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>hostPort</span>: <span style=color:#ae81ff>444</span> <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>主机端口</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>: <span style=color:#a6e22e>TCP</span>
</span></span></code></pre></div><h6 id=列出集群>列出集群</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kind</span> <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>clusters</span>
</span></span></code></pre></div><p><em>kind
tsk8s</em></p><h6 id=切换群集>切换群集</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>切换到群集</span><span style=color:#e6db74>`kind`</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>cluster</span><span style=color:#f92672>-</span><span style=color:#a6e22e>info</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>context</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>-</span><span style=color:#a6e22e>kind</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>切换到群集</span><span style=color:#e6db74>`tsk8s`</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>cluster</span><span style=color:#f92672>-</span><span style=color:#a6e22e>info</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>context</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>-</span><span style=color:#a6e22e>tsk8s</span>
</span></span></code></pre></div><h6 id=查看节点>查看节点</h6><p>默认只有一个</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>nodes</span>
</span></span></code></pre></div><h6 id=删除群集>删除群集</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kind</span> <span style=color:#a6e22e>delete</span> <span style=color:#a6e22e>cluster</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>name</span> <span style=color:#a6e22e>tsk8s</span>
</span></span></code></pre></div><h6 id=将图像加载到集群中>将图像加载到集群中</h6><p>本机镜像加载到 Kind 群集</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kind</span> <span style=color:#a6e22e>load</span> <span style=color:#a6e22e>docker</span><span style=color:#f92672>-</span><span style=color:#a6e22e>image</span> <span style=color:#a6e22e>myimage</span>:<span style=color:#a6e22e>tag</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>name</span> <span style=color:#a6e22e>tsk8s</span>
</span></span></code></pre></div><h6 id=获取集群节点上存在的图像列表>获取集群节点上存在的图像列表</h6><p>先要知道节点名</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span> <span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>nodes</span>
</span></span></code></pre></div><p><em>NAME STATUS ROLES AGE VERSION
tsk8s-control-plane Ready control-plane 10d v1.26.3</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>docker</span> <span style=color:#a6e22e>exec</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>it</span> <span style=color:#a6e22e>my</span><span style=color:#f92672>-</span><span style=color:#a6e22e>node</span><span style=color:#f92672>-</span><span style=color:#a6e22e>name</span> <span style=color:#a6e22e>crictl</span> <span style=color:#a6e22e>images</span>
</span></span></code></pre></div><p>其中my-node-name是Docker容器的名称（例如，kind-control-plane）</p><h3 id=使用-dashboard>使用 Dashboard</h3><p>我们除了可以用 kubectl 命令行来控制 K8s 外，我们还可以利用 Dashboard 图形界面来进行一些操作。</p><h5 id=安装>安装</h5><p>下载配置文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>wget</span> <span style=color:#a6e22e>https</span>:<span style=color:#75715e>//raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml</span>
</span></span></code></pre></div><h6 id=部署dashboard>部署Dashboard</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>apply</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span> <span style=color:#a6e22e>recommended</span>.<span style=color:#a6e22e>yaml</span>
</span></span></code></pre></div><h6 id=查看-dashboard-的-pod>查看 Dashboard 的 pod</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>pods</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span> <span style=color:#a6e22e>kubernetes</span><span style=color:#f92672>-</span><span style=color:#a6e22e>dashboard</span>
</span></span></code></pre></div><p>如果 STATUS 不是 Running,调整后执行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>delete</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span> <span style=color:#a6e22e>recommended</span>.<span style=color:#a6e22e>yaml</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>apply</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span> <span style=color:#a6e22e>recommended</span>.<span style=color:#a6e22e>yaml</span>
</span></span></code></pre></div><h6 id=开启-dashboard-连接>开启 Dashboard 连接</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>proxy</span>
</span></span></code></pre></div><p>访问:</p><p><code>http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</code></p><h4 id=创建用户>创建用户</h4><p>创建文件 user.yaml，内容如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>apiVersion</span>: <span style=color:#a6e22e>rbac</span>.<span style=color:#a6e22e>authorization</span>.<span style=color:#a6e22e>k8s</span>.<span style=color:#a6e22e>io</span><span style=color:#f92672>/</span><span style=color:#a6e22e>v1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>kind</span>: <span style=color:#a6e22e>ClusterRoleBinding</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#a6e22e>admin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>user</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>roleRef</span>:
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>apiGroup</span>: <span style=color:#a6e22e>rbac</span>.<span style=color:#a6e22e>authorization</span>.<span style=color:#a6e22e>k8s</span>.<span style=color:#a6e22e>io</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>kind</span>: <span style=color:#a6e22e>ClusterRole</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#a6e22e>cluster</span><span style=color:#f92672>-</span><span style=color:#a6e22e>admin</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>subjects</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> <span style=color:#a6e22e>kind</span>: <span style=color:#a6e22e>ServiceAccount</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#a6e22e>admin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>user</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>namespace</span>: <span style=color:#a6e22e>kubernetes</span><span style=color:#f92672>-</span><span style=color:#a6e22e>dashboard</span>
</span></span></code></pre></div><p>创建用户</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>apply</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>yaml</span>
</span></span></code></pre></div><p>获取登录的 token</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span> <span style=color:#a6e22e>kubernetes</span><span style=color:#f92672>-</span><span style=color:#a6e22e>dashboard</span> <span style=color:#a6e22e>create</span> <span style=color:#a6e22e>token</span> <span style=color:#a6e22e>admin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>user</span>
</span></span></code></pre></div><p>复制 token 并将其粘贴到登录屏幕</p><h5 id=清理和后续步骤>清理和后续步骤</h5><p>删除管理员ServiceAccount和ClusterRoleBinding</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span> <span style=color:#a6e22e>kubernetes</span><span style=color:#f92672>-</span><span style=color:#a6e22e>dashboard</span> <span style=color:#a6e22e>delete</span> <span style=color:#a6e22e>serviceaccount</span> <span style=color:#a6e22e>admin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>user</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span> <span style=color:#a6e22e>kubernetes</span><span style=color:#f92672>-</span><span style=color:#a6e22e>dashboard</span> <span style=color:#a6e22e>delete</span> <span style=color:#a6e22e>clusterrolebinding</span> <span style=color:#a6e22e>admin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>user</span>
</span></span></code></pre></div><h5 id=问题一>问题一</h5><p>当执行<code> kubectl -n kubernetes-dashboard create token admin-user</code>报<code>error: failed to create token: serviceaccounts "admin-user" not found</code>,先执行如下命令:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#a6e22e>create</span> <span style=color:#a6e22e>sa</span> <span style=color:#a6e22e>admin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>user</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span> <span style=color:#a6e22e>kubernetes</span><span style=color:#f92672>-</span><span style=color:#a6e22e>dashboard</span>
</span></span></code></pre></div><p>再次执行获取token</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>kubectl</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span> <span style=color:#a6e22e>kubernetes</span><span style=color:#f92672>-</span><span style=color:#a6e22e>dashboard</span> <span style=color:#a6e22e>create</span> <span style=color:#a6e22e>token</span> <span style=color:#a6e22e>admin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>user</span>
</span></span></code></pre></div><h3 id=部署-ingress>部署 ingress</h3><p>ingress 是 Kubernetes 的一种网络服务，它用于将外部流量引入到集群中的服务。它可以用于将 HTTP 和 HTTPS 流量从外部世界引入到集群中的服务，并对流量进行路由和负载均衡。</p><p>这里以 ingress-nginx 为例:</p><h4 id=创建群集>创建群集</h4></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 臭大佬博客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/choudalao.github.io/js/menu.js></script></body></html>