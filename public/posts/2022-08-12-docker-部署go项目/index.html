<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker 部署go项目 - 臭大佬博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="docker  部署go项目">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="臭大佬博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">臭大佬博客</div>
					
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">菜单</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">首页</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">归档</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">关于</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker 部署go项目</h1>
			
		</header>
		<div class="content post__content clearfix">
			<h1 id="说明">说明</h1>
<p>简单介绍一下，docker和docker-compose部署go项目。</p>
<h2 id="docker-部署">docker 部署</h2>
<p>代码主要分为两块,一块是<code>go</code>代码块,另一个是构建脚本
目录结构如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Dockerfile</span>  <span style="color:#75715e">// docker脚本</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">go_run</span>.<span style="color:#a6e22e">sh</span>  <span style="color:#75715e">// 启动go脚本</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">build</span>.<span style="color:#a6e22e">sh</span> <span style="color:#75715e">// 构建脚本</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>  <span style="color:#75715e">// go 入口文件</span>
</span></span></code></pre></div><p><img src="https://www.choudalao.com/uploads/20220812/20220812115714ebKchq.png" alt=""></p>
<h5 id="各文件说明">各文件说明:</h5>
<p><code>main.go</code> 程序启动一个<code>go</code>服务,并且监听<code>5005</code>端口;
<code>Dockerfile</code> 构建镜像
<code>go-build.sh</code> 执行构建脚本,所有的步骤都加载在里面了,
<code>go_run.sh</code> 执行打包好的<code>go</code>文件</p>
<h5 id="执行流程">执行流程</h5>
<p>运行<code>./go-build.sh</code>文件,执行里面的操作,先是打包<code>go</code>服务,然后构建<code>docker</code>镜像,最后启动容器.</p>
<h5 id="各文件内容">各文件内容</h5>
<p>Dockerfile</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">alpine</span>:<span style="color:#a6e22e">latest</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WORKDIR</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">server</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">EXPOSE</span> <span style="color:#ae81ff">5005</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RUN</span> <span style="color:#a6e22e">mkdir</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">lib64</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">ln</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">s</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">lib</span><span style="color:#f92672">/</span><span style="color:#a6e22e">libc</span>.<span style="color:#a6e22e">musl</span><span style="color:#f92672">-</span><span style="color:#a6e22e">x86_64</span>.<span style="color:#a6e22e">so</span><span style="color:#ae81ff">.1</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">lib64</span><span style="color:#f92672">/</span><span style="color:#a6e22e">ld</span><span style="color:#f92672">-</span><span style="color:#a6e22e">linux</span><span style="color:#f92672">-</span><span style="color:#a6e22e">x86</span><span style="color:#f92672">-</span><span style="color:#ae81ff">64.</span><span style="color:#a6e22e">so</span><span style="color:#ae81ff">.2</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ADD</span> .<span style="color:#f92672">/</span><span style="color:#a6e22e">go_run</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">server</span><span style="color:#f92672">/</span><span style="color:#a6e22e">go_run</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RUN</span>  <span style="color:#a6e22e">chmod</span> <span style="color:#a6e22e">u</span><span style="color:#f92672">+</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">server</span><span style="color:#f92672">/</span><span style="color:#a6e22e">go_run</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">COPY</span> .<span style="color:#f92672">/</span><span style="color:#a6e22e">go_run</span>.<span style="color:#a6e22e">sh</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">server</span><span style="color:#f92672">/</span><span style="color:#a6e22e">go_run</span>.<span style="color:#a6e22e">sh</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RUN</span> <span style="color:#a6e22e">chmod</span> <span style="color:#a6e22e">u</span><span style="color:#f92672">+</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">server</span><span style="color:#f92672">/</span><span style="color:#a6e22e">go_run</span>.<span style="color:#a6e22e">sh</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">CMD</span> [<span style="color:#e6db74">&#34;/server/go_run.sh&#34;</span>]
</span></span></code></pre></div><p>go_run.sh</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>!<span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sh</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">exec</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">server</span><span style="color:#f92672">/</span><span style="color:#a6e22e">go_run</span>
</span></span></code></pre></div><p>go-build.sh</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>!<span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bash</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">构建程序</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">test</span>=<span style="color:#e6db74">&#34;export GO111MODULE=on &amp;&amp; CGO_ENABLED=1 GOOS=linux GOARCH=amd64; go mod tidy; go build  -o &#39;go_run&#39; main.go;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">bash</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">c</span> <span style="color:#e6db74">&#34;$test&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">构建docker</span> <span style="color:#a6e22e">image</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">build</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">t</span> <span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">test</span><span style="color:#f92672">/</span><span style="color:#a6e22e">develop</span> .
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">构建docker</span> <span style="color:#a6e22e">container</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">删除旧容器1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">stop</span> <span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">test</span><span style="color:#f92672">-</span><span style="color:#ae81ff">20009</span>;<span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">rm</span> <span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">test</span><span style="color:#f92672">-</span><span style="color:#ae81ff">20009</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">新建容器1</span> <span style="color:#a6e22e">外部20009端口映射到容器内5005端口</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">run</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">itd</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">v</span> :<span style="color:#f92672">/</span><span style="color:#a6e22e">www</span><span style="color:#f92672">/</span><span style="color:#a6e22e">wwwroot</span><span style="color:#f92672">/</span><span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">run</span><span style="color:#f92672">/</span>:<span style="color:#f92672">/</span><span style="color:#a6e22e">data</span><span style="color:#f92672">/</span><span style="color:#a6e22e">log</span><span style="color:#f92672">/</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">p</span> <span style="color:#ae81ff">20009</span>:<span style="color:#ae81ff">5005</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">name</span> <span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">test</span><span style="color:#f92672">-</span><span style="color:#ae81ff">20009</span> <span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">test</span><span style="color:#f92672">/</span><span style="color:#a6e22e">develop</span>:<span style="color:#a6e22e">latest</span>
</span></span></code></pre></div><p>main.go</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">db</span> = make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">setupRouter</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/ping&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#e6db74">&#34;pong&#34;</span>)
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">r</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">setupRouter</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#e6db74">&#34;:5005&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="构建">构建</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>.<span style="color:#f92672">/</span><span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">build</span>.<span style="color:#a6e22e">sh</span>
</span></span></code></pre></div><p><img src="https://www.choudalao.com/uploads/20220812/20220812115852TyFtHc.png" alt=""></p>
<h2 id="docker-compose-部署">docker compose 部署</h2>
<p>上面的步骤比较繁琐，除了构建，还需要运行各种参数，可以使用 Docker 容器管理工具 docker compose 解决此问题。
<img src="https://www.choudalao.com/uploads/20221018/20221018221754oaUOV0.png" alt=""></p>
<p>目录结构如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Dockerfile</span>  <span style="color:#75715e">// 构建脚本</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span>.<span style="color:#a6e22e">yml</span> <span style="color:#75715e">// 配置运行容器需要的命令和参数</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>  <span style="color:#75715e">// go 入口文件</span>
</span></span></code></pre></div><p>docker-compose.yml 文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">version</span>: <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">3.8</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">test</span><span style="color:#f92672">-</span><span style="color:#ae81ff">20009</span>: <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">容器</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">restart</span>: <span style="color:#a6e22e">always</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Docker</span> <span style="color:#a6e22e">重启时</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">容器也重启</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">build</span>: <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">构建</span> <span style="color:#a6e22e">Docker</span> <span style="color:#a6e22e">镜像</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">context</span>: .<span style="color:#f92672">/</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Dockerfile</span> <span style="color:#a6e22e">文件的目录</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">dockerfile</span>: <span style="color:#a6e22e">Dockerfile</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Dockerfile</span> <span style="color:#a6e22e">文件的名称</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">image</span>: <span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">test</span><span style="color:#f92672">/</span><span style="color:#a6e22e">develop</span>:<span style="color:#a6e22e">latest</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">镜像名称和版本号</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">container_name</span>: <span style="color:#66d9ef">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">test</span><span style="color:#f92672">-</span><span style="color:#ae81ff">20009</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">容器名称</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ports</span>: <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">宿主机</span>:<span style="color:#a6e22e">容器之间映射端口</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#e6db74">&#34;20009:5005&#34;</span>
</span></span></code></pre></div><p>Dockerfile 文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">golang</span>:<span style="color:#a6e22e">alpine</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">builder</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">需要go环境</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">MAINTAINER</span> <span style="color:#a6e22e">vijay</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WORKDIR</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">work</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">源</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RUN</span> <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">env</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">w</span> <span style="color:#a6e22e">GOPROXY</span>=<span style="color:#a6e22e">https</span>:<span style="color:#75715e">//goproxy.cn,direct &amp;&amp; go env -w CGO_ENABLED=0</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">COPY</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">mod</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">sum</span> .<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RUN</span> <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">mod</span> <span style="color:#a6e22e">download</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">COPY</span> . .
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RUN</span> <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">build</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">o</span> <span style="color:#a6e22e">main</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">alpine</span>:<span style="color:#a6e22e">latest</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">设置时区</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RUN</span> <span style="color:#a6e22e">apk</span> <span style="color:#a6e22e">add</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">no</span><span style="color:#f92672">-</span><span style="color:#a6e22e">cache</span> <span style="color:#a6e22e">tzdata</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">cp</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">share</span><span style="color:#f92672">/</span><span style="color:#a6e22e">zoneinfo</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Asia</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Shanghai</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">localtime</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">echo</span> <span style="color:#e6db74">&#34;Asia/Shanghai&#34;</span> &gt;  <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">timezone</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WORKDIR</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">server</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">复制到工作区</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">COPY</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">from</span>=<span style="color:#a6e22e">builder</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">work</span><span style="color:#f92672">/</span> .<span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">COPY</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">from</span>=<span style="color:#a6e22e">builder</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">work</span><span style="color:#f92672">/</span><span style="color:#a6e22e">config</span> .<span style="color:#f92672">/</span><span style="color:#a6e22e">config</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">对外端口</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">EXPOSE</span> <span style="color:#ae81ff">5005</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">执行</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">CMD</span> [<span style="color:#e6db74">&#34;./main&#34;</span>]
</span></span></code></pre></div><h3 id="执行命令">执行命令</h3>
<p>docker-compose up</p>
<h2 id="docker-compose-命令">docker-compose 命令</h2>
<p>构建（重新构建）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">build</span> 
</span></span></code></pre></div><p>启动容器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">up</span>
</span></span></code></pre></div><p>后台启动并运行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">up</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">d</span>
</span></span></code></pre></div><p>查看容器列表</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">ps</span>
</span></span></code></pre></div><p>查看日志（-f 一直监听）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">logs</span>
</span></span></code></pre></div><p>关闭容器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">stop</span>
</span></span></code></pre></div><p>启动容器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">start</span>
</span></span></code></pre></div><p>重启容器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">restart</span>
</span></span></code></pre></div><p>删除容器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">rm</span>
</span></span></code></pre></div><p>进入容器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">exec</span> <span style="color:#a6e22e">xxx</span> <span style="color:#a6e22e">sh</span>
</span></span></code></pre></div><p>xxx是容器名称</p>
<p><a href="https://yeasy.gitbook.io/docker_practice/compose/commands#up" title="docker-compose 命令说明">docker-compose 命令说明</a></p>
<h2 id="访问">访问</h2>
<h3 id="ip端口">ip+端口</h3>
<p>可以使用ip+端口进行访问:
<img src="https://www.choudalao.com/uploads/20220812/20220812115933g3ei0k.png" alt=""></p>
<h3 id="nginx-反向代理">nginx 反向代理</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">反向代理配置</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">server</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">server_name</span> <span style="color:#a6e22e">xxx</span>.<span style="color:#a6e22e">choudalao</span>.<span style="color:#a6e22e">com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">其他配置</span> <span style="color:#f92672">...</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">location</span> <span style="color:#f92672">/</span> {
</span></span><span style="display:flex;"><span>		 <span style="color:#a6e22e">proxy_pass</span> <span style="color:#a6e22e">http</span>:<span style="color:#75715e">//127.0.0.1:20009;# http://xxx.com;# 也可以是域名</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="反射后访问">反射后访问</h3>
<p>反射后,可以使用域名访问
<img src="https://www.choudalao.com/uploads/20220812/20220812124041yYTiXk.png" alt=""></p>
<h1 id="问题">问题</h1>
<h3 id="docker-启动alpine镜像中可执行程序文件遇到-not-found">Docker 启动alpine镜像中可执行程序文件遇到 not found</h3>
<h4 id="原因">原因</h4>
<p>由于alpine镜像使用的是musl libc而不是gnu libc，/lib64/ 是不存在的。但他们是兼容的，可以创建个软连接过去试试!
这种情况是因为动态链接库位置错误导致的，alpine镜像使用的是musl libc而不是gun libc。因而动态链接库的位置不一致 。</p>
<p>而一般二进制文件在linux系统下编译，动态链接库是到/lib64目录下的，在alpine镜像内无/lib64目录 。</p>
<h4 id="解决方法">解决方法</h4>
<p>Dockerfile 文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">alpine</span>:<span style="color:#a6e22e">latest</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">这个是重点</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">RUN</span> <span style="color:#a6e22e">mkdir</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">lib64</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">ln</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">s</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">lib</span><span style="color:#f92672">/</span><span style="color:#a6e22e">libc</span>.<span style="color:#a6e22e">musl</span><span style="color:#f92672">-</span><span style="color:#a6e22e">x86_64</span>.<span style="color:#a6e22e">so</span><span style="color:#ae81ff">.1</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">lib64</span><span style="color:#f92672">/</span><span style="color:#a6e22e">ld</span><span style="color:#f92672">-</span><span style="color:#a6e22e">linux</span><span style="color:#f92672">-</span><span style="color:#a6e22e">x86</span><span style="color:#f92672">-</span><span style="color:#ae81ff">64.</span><span style="color:#a6e22e">so</span><span style="color:#ae81ff">.2</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">其他代码</span>
</span></span></code></pre></div>
		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2026 臭大佬博客.
			<span class="footer__copyright-credits">基于 <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> 引擎和 <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> 主题</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>