<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>【转】Nginx服务器防止被压力测试 - 臭大佬博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Nginx服务器防止被压力测试"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title=臭大佬博客 rel=home><div class="logo__item logo__text"><div class=logo__title>臭大佬博客</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/post/><span class=menu__text>归档</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>【转】Nginx服务器防止被压力测试</h1></header><div class="content post__content clearfix"><p>cat nginx.conf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>http</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>limit_conn_zone</span> $binary_remote_addr <span style=color:#a6e22e>zone</span><span style=color:#f92672>=</span><span style=color:#a6e22e>one</span><span style=color:#f92672>:</span><span style=color:#ae81ff>10</span><span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>#如果在1.1.8之后版本还用语法：limit_zone name $variable size，会报警告nginx: [warn] the &#34;limit_zone” directive is deprecated, use the &#34; limit_conn_zone”directive
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#这里，设置客户端的IP地址作为键。注意，这里使用的是$binary_remote_addr变量，而不是$remote_addr变量。$remote_addr变量的长度为7字节到15字节不等，而存储状态在32位平台中占用32字节或64字节，在64位平台中占用64字节。而$binary_remote_addr变量的长度是固定的4字节，存储状态在32位平台中占用32字节或64字节，在64位平台中占用64字节。一兆字节的共享内存空间可以保存3.2万个32位的状态，1.6万个64位的状态。如果共享内存空间被耗尽，服务器将会对后续所有的请求返回 503(Service Temporarily Unavailable) 错误。
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>每个server中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>server</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>limit_conn</span> <span style=color:#a6e22e>one</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>#指定一个会话最大的并发连接数(与之前的limit_conn_zone配合使用)，可对单独目录做出限制，一个IP只能发起10个连接，多于10个，一律返回Services unavailable（503）状态，生产环境需考虑办公室或者局域网共享IP问题
</span></span></span><span style=display:flex><span>	<span style=color:#a6e22e>limit_rate_after</span> <span style=color:#ae81ff>1</span><span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>#设置单连接限速条件(当下载文件字节数超过1MB后，limit_rate限速生效，限速100k)
</span></span></span><span style=display:flex><span>	<span style=color:#a6e22e>limit_rate</span> <span style=color:#ae81ff>100</span><span style=color:#a6e22e>k</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>#单连接限速
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>转载自：https://blog.51cto.com/nicking/1550270</p></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 臭大佬博客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>