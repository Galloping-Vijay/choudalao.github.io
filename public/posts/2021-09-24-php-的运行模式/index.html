<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PHP 的运行模式 - 臭大佬博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="PHP 的运行模式">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="臭大佬博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">臭大佬博客</div>
					
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">菜单</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">首页</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">归档</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">关于</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">PHP 的运行模式</h1>
			
		</header>
		<div class="content post__content clearfix">
			<h2 id="model方式">Model方式</h2>
<p><code>PHP Module</code>加载方式,就是把<code>php</code>作为<code>apache</code>的一个子模块运行.当通过<code>web</code>访问php文件时,<code>apache</code>就会调用<code>php5_module</code>来解析<code>php</code>代码。</p>
<p><code>php5_module</code> 通过<code>sapi</code>将数据传给<code>php</code>解析器解析<code>php</code>代码。</p>
<p><img src="https://www.choudalao.com/uploads/20210924/20210924144826g5CKgE.png" alt=""></p>
<p><code>apache</code>每接收一个请求，都会产生一个进程来连接<code>php</code>通过<code>sapi</code>来完成请求，如果一旦用户过多，并发数过多，服务器就会承受不住了。</p>
<p>而且，把<code>mod_php</code>编进<code>apache</code>时，出问题时很难定位是<code>php</code>的问题还是<code>apache</code>的问题。</p>
<h2 id="cgi">CGI</h2>
<p>早期的<code>web</code>服务器,只能处理用户请求的静态资源如<code>html</code>,并将存储在服务器端的静态资源返回给浏览器,由于<code>web</code>服务器不能处理动态脚本(<code>php</code>),无法实现数据互通,为了解决此问题出现了<code>CGI</code>（Common Gateway Interface）全称是”通用网关接口”,其实就是<code>web</code>服务器(中间件)与动态语言进行”交流”的协议(约定)。</p>
<p><code>CGI</code>的好处就是完全独立于任何服务器，仅仅是做为中间分子。提供接口给<code>apache</code>和<code>php</code>。他们通过<code>cgi</code>搭线来完成数据传递。这样做的好处了尽量减少2个的关联，使他们2变得更独立。</p>
<p><code>Web</code>服务器会传<code>url</code>,查询字符串,<code>post</code>数据,<code>HTTP headers</code>给<code>php</code>解析器,但是<code>cgi</code>在高并发时效率会很低.因为<code>web</code>服务器遇到动态请求时,服务器会<code>fork</code>一个新的进程启动<code>CGI</code>程序,解析动态脚本语言,将结果返回给<code>web</code>服务器,<code>web</code>服务器返回给客户端,处理完成后<code>fork</code>的进程关闭,之后用户每次请求动态脚本语言都是这样一个复杂的过程,其效率可想而知。</p>
<h2 id="fastcgi">Fastcgi</h2>
<p>为了解决<code>web</code>服务器每接收一个动态请求都<code>fork</code>一个进程，结束<code>kill</code>掉这个进程的问题，便出现了<code>CGI</code>的改良版&ndash;<code>Fast-CGI</code>（Fast Common GatewayInterface／FastCGI）快速通用网关接口。</p>
<p>Fast-CGI每次处理完请求后，不会kill掉这个进程，而是保留这个进程，从而使服务器可以同时处理更多的网页请求。这样就会大大的提高效率。</p>
<p><code>PHP-CGI</code>：是 <code>PHP</code> （Web Application）对 <code>Web Server</code> 提供的 <code>CGI</code> 协议的接口程序。 同时是<code>PHP</code>自带的<code>Fast-CGI</code>管理器，性能差，很麻烦不人性化，<code>PHP-FPM</code>的出现优化了<code>PHP-CGI</code>。</p>
<p><code>PHP-FPM</code>：是<code> PHP</code>（Web Application）对 <code>Web Server</code> 提供的 <code>FastCGI</code> 协议的接口程序，额外还提供了相对智能一些任务管理.<code>PHP-FPM</code>是<code>Fast-cgi</code>的进程管理器,是<code>FastCGI</code>的一个具体实现，监听<code>9000</code>端口。</p>
<p>包含了<code>master</code>和<code>worker</code>进程，其中<code>master</code>进程负责与<code>web</code>服务器中间件进行通信,接收用户请求,此请求服务器按照<code>Fast-CGI</code>转换,交给<code>worker</code>进程处理,执行<code>php</code>代码。</p>
<p><img src="https://www.choudalao.com/uploads/20210924/20210924145710aAJNRm.png" alt=""></p>
<h2 id="php-cli">php-cli</h2>
<p>php-cli模式属于命令行模式,不需要借助其他程序,直接输入php xx.php 就能执行php代码。
命令行模式和常规web模式明显不一样的是:</p>
<ul>
<li>没有超时时间</li>
<li>默认关闭buffer缓冲</li>
<li>STDIN和STDOUT标准输入/输出/错误 的使用</li>
<li>echo var_dump,phpinfo等输出直接输出到控制台</li>
<li>可使用的类/函数 不同</li>
<li>php.ini配置的不同</li>
</ul>

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2026 臭大佬博客.
			<span class="footer__copyright-credits">基于 <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> 引擎和 <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> 主题</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>