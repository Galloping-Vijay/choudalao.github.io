<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>go 自定义Time类型的JSON字段格式 - 臭大佬博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="go 自定义Time类型的JSON字段格式"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title=臭大佬博客 rel=home><div class="logo__item logo__text"><div class=logo__title>臭大佬博客</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/post/><span class=menu__text>归档</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>go 自定义Time类型的JSON字段格式</h1></header><div class="content post__content clearfix"><h1 id=问题>问题</h1><p>在使用</p><p>Golang中使用gorm时，通过加入gorm.Model到自己的struct来定义一个model。 Gorm是这样定义Model的：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// UserAuditLog XXXX</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserAuditLog</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Id</span>        <span style=color:#66d9ef>uint32</span>    <span style=color:#e6db74>`json:&#34;id&#34; form:&#34;id&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>UserId</span>    <span style=color:#66d9ef>uint32</span>    <span style=color:#e6db74>`json:&#34;user_id&#34; form:&#34;user_id&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Status</span>    <span style=color:#66d9ef>uint32</span>    <span style=color:#e6db74>`json:&#34;status&#34; form:&#34;audit_status&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Reason</span>    <span style=color:#66d9ef>string</span>    <span style=color:#e6db74>`json:&#34;reason&#34; form:&#34;reason&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>AuditorId</span> <span style=color:#66d9ef>uint32</span>    <span style=color:#e6db74>`json:&#34;auditor_id&#34; form:&#34;created_at&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>CreatedAt</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span> <span style=color:#e6db74>`json:&#34;created_at&#34; form:&#34;created_at&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>当我们的API在接收到查询请求时返回一个model通过JSON形式返回给客户端，这时类型为time.Time的字段就会默认以RFC3339的格式返回，所有的这类字段的返回值都固定是2006-01-02T15:04 :05.999999999Z07:00这种格式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ANSIC</span>       = <span style=color:#e6db74>&#34;Mon Jan _2 15:04:05 2006&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>UnixDate</span>    = <span style=color:#e6db74>&#34;Mon Jan _2 15:04:05 MST 2006&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RubyDate</span>    = <span style=color:#e6db74>&#34;Mon Jan 02 15:04:05 -0700 2006&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RFC822</span>      = <span style=color:#e6db74>&#34;02 Jan 06 15:04 MST&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RFC822Z</span>     = <span style=color:#e6db74>&#34;02 Jan 06 15:04 -0700&#34;</span> <span style=color:#75715e>// RFC822 with numeric zone</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RFC850</span>      = <span style=color:#e6db74>&#34;Monday, 02-Jan-06 15:04:05 MST&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RFC1123</span>     = <span style=color:#e6db74>&#34;Mon, 02 Jan 2006 15:04:05 MST&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RFC1123Z</span>    = <span style=color:#e6db74>&#34;Mon, 02 Jan 2006 15:04:05 -0700&#34;</span> <span style=color:#75715e>// RFC1123 with numeric zone</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RFC3339</span>     = <span style=color:#e6db74>&#34;2006-01-02T15:04:05Z07:00&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>RFC3339Nano</span> = <span style=color:#e6db74>&#34;2006-01-02T15:04:05.999999999Z07:00&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Kitchen</span>     = <span style=color:#e6db74>&#34;3:04PM&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Handy time stamps.</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Stamp</span>      = <span style=color:#e6db74>&#34;Jan _2 15:04:05&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>StampMilli</span> = <span style=color:#e6db74>&#34;Jan _2 15:04:05.000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>StampMicro</span> = <span style=color:#e6db74>&#34;Jan _2 15:04:05.000000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>StampNano</span>  = <span style=color:#e6db74>&#34;Jan _2 15:04:05.000000000&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>修改方式如下：</p><h1 id=代码>代码</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>time2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;database/sql/driver&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// JsonTime 格式化时间格式</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>JsonTime</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// MarshalJSON on JsonTime format Time field with %Y-%m-%d %H:%M:%S</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>JsonTime</span>) <span style=color:#a6e22e>MarshalJSON</span>() ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>formatted</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;\&#34;%s\&#34;&#34;</span>, <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Format</span>(<span style=color:#e6db74>&#34;2006-01-02 15:04:05&#34;</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> []byte(<span style=color:#a6e22e>formatted</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Value insert timestamp into mysql need this function.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>JsonTime</span>) <span style=color:#a6e22e>Value</span>() (<span style=color:#a6e22e>driver</span>.<span style=color:#a6e22e>Value</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>zeroTime</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Time</span>.<span style=color:#a6e22e>UnixNano</span>() <span style=color:#f92672>==</span> <span style=color:#a6e22e>zeroTime</span>.<span style=color:#a6e22e>UnixNano</span>() {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Time</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Scan valueof time.Time</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>JsonTime</span>) <span style=color:#a6e22e>Scan</span>(<span style=color:#a6e22e>v</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>v</span>.(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>		<span style=color:#f92672>*</span><span style=color:#a6e22e>t</span> = <span style=color:#a6e22e>JsonTime</span>{<span style=color:#a6e22e>Time</span>: <span style=color:#a6e22e>value</span>}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;can not convert %v to timestamp&#34;</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=使用>使用</h3><p>结构体如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>entity</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span>  <span style=color:#a6e22e>time2</span><span style=color:#e6db74>&#34;time2&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// UserAuditLog XXXX</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserAuditLog</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Id</span>        <span style=color:#66d9ef>uint32</span>         <span style=color:#e6db74>`json:&#34;id&#34; form:&#34;id&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>UserId</span>    <span style=color:#66d9ef>uint32</span>         <span style=color:#e6db74>`json:&#34;user_id&#34; form:&#34;user_id&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Status</span>    <span style=color:#66d9ef>uint32</span>         <span style=color:#e6db74>`json:&#34;status&#34; form:&#34;audit_status&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Reason</span>    <span style=color:#66d9ef>string</span>         <span style=color:#e6db74>`json:&#34;reason&#34; form:&#34;reason&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>AuditorId</span> <span style=color:#66d9ef>uint32</span>         <span style=color:#e6db74>`json:&#34;auditor_id&#34; form:&#34;created_at&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>CreatedAt</span> <span style=color:#a6e22e>time2</span>.<span style=color:#a6e22e>JsonTime</span> <span style=color:#e6db74>`json:&#34;created_at&#34; form:&#34;created_at&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>赋值</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>user</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span><span style=color:#a6e22e>time2</span> <span style=color:#e6db74>&#34;time2&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span><span style=color:#a6e22e>UserAuditLog</span>.<span style=color:#a6e22e>CreatedAt</span> = <span style=color:#a6e22e>time2</span>.<span style=color:#a6e22e>JsonTime</span>{
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Time</span>: <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>(),
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>参考文章
<a href=https://www.axiaoxin.com/article/241/>https://www.axiaoxin.com/article/241/</a></p></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 臭大佬博客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>