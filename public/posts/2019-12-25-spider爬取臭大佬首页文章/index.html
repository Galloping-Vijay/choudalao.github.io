<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spider爬取臭大佬首页文章 - 臭大佬博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="Spider爬取臭大佬首页文章">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="臭大佬博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">臭大佬博客</div>
					
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">菜单</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">首页</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">归档</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">关于</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spider爬取臭大佬首页文章</h1>
			
		</header>
		<div class="content post__content clearfix">
			<h1 id="创建scrapy项目">创建Scrapy项目</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>scrapy startproject choudalao
</span></span></code></pre></div><blockquote>
<p>λ scrapy startproject choudalao
New Scrapy project &lsquo;choudalao&rsquo;, using template directory &rsquo;d:\program files\python\lib\site-packages\scrapy\templates\project&rsquo;, created in:
D:\wwwroot\dev.py.net\choudalao</p>
</blockquote>
<blockquote>
<p>You can start your first spider with:
cd choudalao
scrapy genspider example example.com</p>
</blockquote>
<p><img src="https://www.choudalao.com/uploads/20191225/20191225204906M9bMwy.png" alt=""></p>
<p>目录结构：</p>
<p><img src="https://www.choudalao.com/uploads/20191225/20191225204945vrkFSJ.png" alt=""></p>
<h1 id="创建爬虫">创建爬虫</h1>
<p>进入spider目录下，运行命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>scrapy genspider choudalao <span style="color:#e6db74">&#34;choudalao.com&#34;</span>
</span></span></code></pre></div><p><img src="https://www.choudalao.com/uploads/20191225/20191225210234zSUgiP.png" alt=""></p>
<h1 id="分析">分析</h1>
<p>打开臭大佬<a href="https://www.choudalao.com" title="首页">首页</a>，分析数据结构:
<img src="https://www.choudalao.com/uploads/20191225/20191225205632lCwMqZ.png" alt=""></p>
<p><img src="https://www.choudalao.com/uploads/20191225/20191225205833STF6pV.png" alt="">
每一个li里面都包含标题、作者、链接、标签、浏览数、时间等等。我们就提取这几个字段。</p>
<p>#利用xPath提取内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">//</span>div[<span style="color:#a6e22e">@class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;blogs&#34;</span>]<span style="color:#f92672">/</span>ul<span style="color:#f92672">/</span>li
</span></span></code></pre></div><p><img src="https://www.choudalao.com/uploads/20191225/20191225212320Q4F3Ia.png" alt=""></p>
<p>提取所有标题：
<img src="https://www.choudalao.com/uploads/20191225/20191225213512KLBIoF.png" alt="">
别的以此类推</p>
<h1 id="设置字段">设置字段</h1>
<p>打开 <code>items.py</code>，编辑如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChoudalaoItem</span>(scrapy<span style="color:#f92672">.</span>Item):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 文章标题</span>
</span></span><span style="display:flex;"><span>    title <span style="color:#f92672">=</span> scrapy<span style="color:#f92672">.</span>Field()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 作者</span>
</span></span><span style="display:flex;"><span>    author <span style="color:#f92672">=</span> scrapy<span style="color:#f92672">.</span>Field()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 链接</span>
</span></span><span style="display:flex;"><span>    link <span style="color:#f92672">=</span> scrapy<span style="color:#f92672">.</span>Field()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 标签</span>
</span></span><span style="display:flex;"><span>    keyword <span style="color:#f92672">=</span> scrapy<span style="color:#f92672">.</span>Field()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 浏览数</span>
</span></span><span style="display:flex;"><span>    looks <span style="color:#f92672">=</span> scrapy<span style="color:#f92672">.</span>Field()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 时间</span>
</span></span><span style="display:flex;"><span>    craete_time <span style="color:#f92672">=</span> scrapy<span style="color:#f92672">.</span>Field()
</span></span></code></pre></div><h1 id="提取数据">提取数据</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> scrapy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> choudalao.items <span style="color:#f92672">import</span> ChoudalaoItem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChoudalaoSpider</span>(scrapy<span style="color:#f92672">.</span>Spider):
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;choudalao&#39;</span>
</span></span><span style="display:flex;"><span>    allowed_domains <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;www.choudalao.com&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 起始地址(带分页)</span>
</span></span><span style="display:flex;"><span>    baseUrl <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://www.choudalao.com/?page=&#34;</span>
</span></span><span style="display:flex;"><span>    page <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    start_urls <span style="color:#f92672">=</span> [baseUrl <span style="color:#f92672">+</span> str(page)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(self, response):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 接收数据</span>
</span></span><span style="display:flex;"><span>        node_list <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>xpath(<span style="color:#e6db74">&#39;//div[@class=&#34;blogs&#34;]/ul/li&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 遍历数据</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> node <span style="color:#f92672">in</span> node_list:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 存储到每个item</span>
</span></span><span style="display:flex;"><span>            item <span style="color:#f92672">=</span> ChoudalaoItem()
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 标题</span>
</span></span><span style="display:flex;"><span>            item[<span style="color:#e6db74">&#39;title&#39;</span>] <span style="color:#f92672">=</span> node<span style="color:#f92672">.</span>xpath(<span style="color:#e6db74">&#39;./h3/a/text()&#39;</span>)<span style="color:#f92672">.</span>extract()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 标签</span>
</span></span><span style="display:flex;"><span>            item[<span style="color:#e6db74">&#39;keyword&#39;</span>] <span style="color:#f92672">=</span> node<span style="color:#f92672">.</span>xpath(<span style="color:#e6db74">&#39;./div[@class=&#34;autor&#34;]/span[@class=&#34;lm&#34;]/a/text()&#39;</span>)<span style="color:#f92672">.</span>extract()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 作者</span>
</span></span><span style="display:flex;"><span>            item[<span style="color:#e6db74">&#39;author&#39;</span>] <span style="color:#f92672">=</span> node<span style="color:#f92672">.</span>xpath(<span style="color:#e6db74">&#39;./div[@class=&#34;autor&#34;]/span[@class=&#34;author&#34;]/text()&#39;</span>)<span style="color:#f92672">.</span>extract()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 链接</span>
</span></span><span style="display:flex;"><span>            item[<span style="color:#e6db74">&#39;link&#39;</span>] <span style="color:#f92672">=</span> node<span style="color:#f92672">.</span>xpath(<span style="color:#e6db74">&#39;./span[@class=&#34;blogpic&#34;]/a/@href&#39;</span>)<span style="color:#f92672">.</span>extract()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 浏览数</span>
</span></span><span style="display:flex;"><span>            item[<span style="color:#e6db74">&#39;looks&#39;</span>] <span style="color:#f92672">=</span> node<span style="color:#f92672">.</span>xpath(<span style="color:#e6db74">&#39;./div[@class=&#34;autor&#34;]/span[@class=&#34;viewnum&#34;]/a/text()&#39;</span>)<span style="color:#f92672">.</span>extract()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 时间</span>
</span></span><span style="display:flex;"><span>            item[<span style="color:#e6db74">&#39;craete_time&#39;</span>] <span style="color:#f92672">=</span> node<span style="color:#f92672">.</span>xpath(<span style="color:#e6db74">&#39;./div[@class=&#34;autor&#34;]/span[@class=&#34;dtime&#34;]/text()&#39;</span>)<span style="color:#f92672">.</span>extract()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">yield</span> item
</span></span></code></pre></div><h1 id="编写管道文件">编写管道文件</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define your item pipelines here</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Don&#39;t forget to add your pipeline to the ITEM_PIPELINES setting</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChoudalaoPipeline</span>(object):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;choudalao.json&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">process_item</span>(self, item, spider):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 转成字典,写入json格式</span>
</span></span><span style="display:flex;"><span>        content <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>dumps(dict(item), ensure_ascii<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>f<span style="color:#f92672">.</span>write(content)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> item
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">clone_spider</span>(self, spider):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>f<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h1 id="配置启用管道">配置启用管道</h1>
<p>在settings.py文件中搜索<code>ITEM_PIPELINES</code>，打开注释</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ITEM_PIPELINES <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#39;choudalao.pipelines.ChoudalaoPipeline&#39;</span>: <span style="color:#ae81ff">300</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img src="https://www.choudalao.com/uploads/20191225/201912252206399PVMGC.png" alt=""></p>
<h1 id="运行">运行</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>scrapy crawl choudalao
</span></span></code></pre></div><p><img src="https://www.choudalao.com/uploads/20191226/20191226000835C39YY9.png" alt=""></p>
<p>抓取的数据截图
<img src="https://www.choudalao.com/uploads/20191226/20191226001315NB2C1u.png" alt=""></p>

		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2026 臭大佬博客.
			<span class="footer__copyright-credits">基于 <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> 引擎和 <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> 主题</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>