<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker 安装 kafka - 臭大佬博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="docker 安装 kafka">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="臭大佬博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">臭大佬博客</div>
					
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">菜单</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">首页</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">归档</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">关于</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker 安装 kafka</h1>
			
		</header>
		<div class="content post__content clearfix">
			<h1 id="说明">说明</h1>
<p>到 <a href="https://hub.docker.com/search?q=kafka" title="docker hub">docker hub</a> 去搜一下<code>kafka</code>, 排在第一位的是<code>bitnami/kafka</code>,我们就用它了。</p>
<h3 id="下载-docker-composeyml">下载 docker-compose.yml</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">curl</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">sSL</span> <span style="color:#a6e22e">https</span>:<span style="color:#75715e">//raw.githubusercontent.com/bitnami/containers/main/bitnami/kafka/docker-compose.yml &gt; docker-compose.yml</span>
</span></span></code></pre></div><h3 id="修改-docker-composeyml-配置外网访问">修改 docker-compose.yml ,配置外网访问</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">version</span>: <span style="color:#e6db74">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">zookeeper</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">image</span>: <span style="color:#a6e22e">docker</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bitnami</span><span style="color:#f92672">/</span><span style="color:#a6e22e">zookeeper</span>:<span style="color:#ae81ff">3.8</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ports</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#e6db74">&#34;2181:2181&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">volumes</span>:
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">-</span> <span style="color:#e6db74">&#34;zookeeper_data:/bitnami&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">ALLOW_ANONYMOUS_LOGIN</span>=<span style="color:#a6e22e">yes</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">匿名登录</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">kafka</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">image</span>: <span style="color:#a6e22e">docker</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bitnami</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kafka</span>:<span style="color:#ae81ff">3.4</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ports</span>: <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">记得在防火墙开放端口</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#e6db74">&#34;9092:9092&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#e6db74">&#34;9093:9093&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">volumes</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#e6db74">&#34;kafka_data:/bitnami&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">KAFKA_CFG_ZOOKEEPER_CONNECT</span>=<span style="color:#a6e22e">zookeeper</span>:<span style="color:#ae81ff">2181</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">ALLOW_PLAINTEXT_LISTENER</span>=<span style="color:#a6e22e">yes</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">配置监听者的安全协议</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP</span>=<span style="color:#a6e22e">CLIENT</span>:<span style="color:#a6e22e">PLAINTEXT</span>,<span style="color:#a6e22e">EXTERNAL</span>:<span style="color:#a6e22e">PLAINTEXT</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">定义Kafka</span> <span style="color:#a6e22e">Broker的Listener的配置项</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">配置外部访问和内部访问</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">KAFKA_CFG_LISTENERS</span>=<span style="color:#a6e22e">CLIENT</span>:<span style="color:#75715e">//:9092,EXTERNAL://0.0.0.0:9093 # 将Broker的Listener信息发布到Zookeeper中，供Clients（Producer/Consumer）使用</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">KAFKA_CFG_ADVERTISED_LISTENERS</span>=<span style="color:#a6e22e">CLIENT</span>:<span style="color:#75715e">//kafka:9092,EXTERNAL://dev.wsl.net:9093 # dev.wsl.net 换成自己的ip</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">KAFKA_CFG_INTER_BROKER_LISTENER_NAME</span>=<span style="color:#a6e22e">CLIENT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">depends_on</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">zookeeper</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">volumes</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">zookeeper_data</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">driver</span>: <span style="color:#a6e22e">local</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">kafka_data</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">driver</span>: <span style="color:#a6e22e">local</span>
</span></span></code></pre></div><p>运行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">compose</span> <span style="color:#a6e22e">up</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">d</span>
</span></span></code></pre></div><p><img src="https://www.choudalao.com/uploads/20230325/20230325203849tT8Ktl.png" alt=""></p>
<p><img src="https://www.choudalao.com/uploads/20230325/202303252038585eBMUd.png" alt=""></p>
<h3 id="可视化-kafka-map">可视化 kafka-map</h3>
<p><a href="https://gitee.com/dushixiang/kafka-map" title="kafka-map 介绍">kafka-map 介绍</a></p>
<p>记得开放端口9090</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">run</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">d</span>  <span style="color:#f92672">-</span><span style="color:#a6e22e">p</span> <span style="color:#ae81ff">9090</span>:<span style="color:#ae81ff">8080</span>   <span style="color:#f92672">-</span><span style="color:#a6e22e">v</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">www</span><span style="color:#f92672">/</span><span style="color:#a6e22e">wwwroot</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kafka</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kafka</span><span style="color:#f92672">-</span><span style="color:#66d9ef">map</span><span style="color:#f92672">/</span><span style="color:#a6e22e">data</span>:<span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">local</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kafka</span><span style="color:#f92672">-</span><span style="color:#66d9ef">map</span><span style="color:#f92672">/</span><span style="color:#a6e22e">data</span>     <span style="color:#f92672">-</span><span style="color:#a6e22e">e</span> <span style="color:#a6e22e">DEFAULT_USERNAME</span>=<span style="color:#a6e22e">admin</span>     <span style="color:#f92672">-</span><span style="color:#a6e22e">e</span> <span style="color:#a6e22e">DEFAULT_PASSWORD</span>=<span style="color:#a6e22e">admin</span>  <span style="color:#f92672">--</span><span style="color:#a6e22e">name</span> <span style="color:#a6e22e">kafka</span><span style="color:#f92672">-</span><span style="color:#66d9ef">map</span>   <span style="color:#f92672">--</span><span style="color:#a6e22e">restart</span> <span style="color:#a6e22e">always</span> <span style="color:#a6e22e">dushixiang</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kafka</span><span style="color:#f92672">-</span><span style="color:#66d9ef">map</span>:<span style="color:#a6e22e">latest</span>
</span></span></code></pre></div><p><img src="https://www.choudalao.com/uploads/20230325/20230325211720UZvHbt.png" alt=""></p>
<h3 id="go中简单使用">go中简单使用</h3>
<p>Go语言中连接kafka使用第三方库: github.com/Shopify/sarama。
获取<code>go get github.com/Shopify/sarama</code></p>
<p>发送数据</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/Shopify/sarama&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">topicTitle</span> = <span style="color:#e6db74">&#34;wsl-topic&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//kafka配置项</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">config</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sarama</span>.<span style="color:#a6e22e">NewConfig</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Producer</span>.<span style="color:#a6e22e">RequiredAcks</span> = <span style="color:#a6e22e">sarama</span>.<span style="color:#a6e22e">WaitForAll</span>          <span style="color:#75715e">// 发送完数据需要leader和follow都确认</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Producer</span>.<span style="color:#a6e22e">Partitioner</span> = <span style="color:#a6e22e">sarama</span>.<span style="color:#a6e22e">NewRandomPartitioner</span> <span style="color:#75715e">// 新选出一个partition</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Producer</span>.<span style="color:#a6e22e">Return</span>.<span style="color:#a6e22e">Successes</span> = <span style="color:#66d9ef">true</span>                   <span style="color:#75715e">// 成功交付的消息将在success channel返回</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 连接kafka</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sarama</span>.<span style="color:#a6e22e">NewSyncProducer</span>([]<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;dev.wsl.net:9093&#34;</span>}, <span style="color:#a6e22e">config</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;producer closed, err:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 构造消息</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">msg</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sarama</span>.<span style="color:#a6e22e">ProducerMessage</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">Topic</span> = <span style="color:#a6e22e">topicTitle</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">Value</span> = <span style="color:#a6e22e">sarama</span>.<span style="color:#a6e22e">StringEncoder</span>(<span style="color:#e6db74">&#34;这是一条测试数据&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 发送消息</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">pid</span>, <span style="color:#a6e22e">offset</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">SendMessage</span>(<span style="color:#a6e22e">msg</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;发送失败, err:&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;pid:%v offset:%v\n&#34;</span>, <span style="color:#a6e22e">pid</span>, <span style="color:#a6e22e">offset</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>消费数据</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/Shopify/sarama&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">topicTitle</span> = <span style="color:#e6db74">&#34;wsl-topic&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 配置Kafka消费者</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">config</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sarama</span>.<span style="color:#a6e22e">NewConfig</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Consumer</span>.<span style="color:#a6e22e">Return</span>.<span style="color:#a6e22e">Errors</span> = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">consumer</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sarama</span>.<span style="color:#a6e22e">NewConsumer</span>([]<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;dev.wsl.net:9093&#34;</span>}, <span style="color:#a6e22e">config</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">partitionList</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">consumer</span>.<span style="color:#a6e22e">Partitions</span>(<span style="color:#a6e22e">topicTitle</span>) <span style="color:#75715e">// 根据topic取到所有的分区</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;fail to get list of partition:err%v\n&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;分区列表&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">partitionList</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">partition</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">partitionList</span> { <span style="color:#75715e">// 遍历所有的分区</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// 针对每个分区创建一个对应的分区消费者</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">pc</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">consumer</span>.<span style="color:#a6e22e">ConsumePartition</span>(<span style="color:#a6e22e">topicTitle</span>, int32(<span style="color:#a6e22e">partition</span>), <span style="color:#a6e22e">sarama</span>.<span style="color:#a6e22e">OffsetNewest</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;failed to start consumer for partition %d,err:%v\n&#34;</span>, <span style="color:#a6e22e">partition</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">sarama</span>.<span style="color:#a6e22e">PartitionConsumer</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">pc</span>.<span style="color:#a6e22e">AsyncClose</span>()
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">select</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">case</span> <span style="color:#a6e22e">msg</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">pc</span>.<span style="color:#a6e22e">Messages</span>():
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Partition:%d Offset:%d Key:%v Value:%v \n&#34;</span>, <span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">Partition</span>, <span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">Offset</span>, string(<span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">Key</span>), string(<span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">Value</span>))
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">case</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">pc</span>.<span style="color:#a6e22e">Errors</span>():
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Error: %v\n&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}(<span style="color:#a6e22e">pc</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
		</div>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2026 臭大佬博客.
			<span class="footer__copyright-credits">基于 <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> 引擎和 <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> 主题</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>