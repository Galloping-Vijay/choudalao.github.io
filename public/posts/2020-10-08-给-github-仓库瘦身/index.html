<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>给 github 仓库瘦身 - 臭大佬博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="给 github 仓库瘦身"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title=臭大佬博客 rel=home><div class="logo__item logo__text"><div class=logo__title>臭大佬博客</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/post/><span class=menu__text>归档</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>给 github 仓库瘦身</h1></header><div class="content post__content clearfix"><h1 id=问题>问题</h1><p>随着我们提交代码次数的增多，你会发现 Git 包变得越来越臃肿，尤其是上传大文件上去的时候，当你删除文件时，其实 .git目录下的大文件对象是不会被删除的。 Git 会把文件的每一个差异化版本都记录在案。这意味着，即使你只改动了某个文件的一行内容，Git 也会生成一个全新的对象来存储新的文件内容。</p><p>由于没太注意，我的项目 <a href=https://github.com/Galloping-Vijay/laravel-wjfcms/tree/master title=laravel-wjfcms>laravel-wjfcms</a>，上传过许多大文件，之前为了找一个好看的背景，上传了好些几个G大小的壁纸上去，还有测试的时候把 .exe文件扔上去过，再加上国内访问<code>github</code>本来就龟速了，导致项目很多时候无法下载。</p><p><del>E:\www\siren>git clone <a href=https://github.com/Galloping-Vijay/laravel-wjfcms.git>https://github.com/Galloping-Vijay/laravel-wjfcms.git</a>
Cloning into &rsquo;laravel-wjfcms&rsquo;&mldr;
remote: Enumerating objects: 977, done.
remote: Counting objects: 100% (977/977), done.
remote: Compressing objects: 100% (492/492), done.
effrror: RPC failed; curl 18 transfer closed with outstanding read data remaining
atal: the remote end hung up unexpectedly
atal: early EOF
fatal: index-pack failed</del></p><p><img src=https://www.choudalao.com/uploads/20201008/20201008150517MBC0hy.png alt></p><p>放弃当前包，重新建一个，感觉还是有感情的，不想放弃这个包，那怎样才能解决下载问题呢？</p><h1 id=尝试过的方法>尝试过的方法</h1><h4 id=修改上传大小>修改上传大小</h4><p>看网上说这可能是上传大小限制造成的，</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>config</span> <span style=color:#a6e22e>http</span><span style=color:#f92672>.</span><span style=color:#a6e22e>postBuffer</span> <span style=color:#ae81ff>524288000</span>
</span></span></code></pre></div><p>运行如上命令并没有什么效果。</p><h3 id=修改-host-文件>修改 host 文件</h3><p>其实下载只是慢一点，访问github还是没有问题的，别的 github项目拉去速度都还可以，就自己的拉去不下来，所以可以排除 本地DNS 问题</p><h3 id=清理大文件>清理大文件</h3><p>之前有尝试过清理.git文件夹下面的大文件，操作在文章 <a href=https://www.choudalao.com/article/179 title=github仓库中删除历史大文件>github仓库中删除历史大文件</a> 中有说明。但是效果并不好。</p><h1 id=终极大法--删除版本记录>终极大法 &ndash; 删除版本记录</h1><p>git包那么大，其实很多都是log及版本记录造成的，版本记录里面包含了所有文件的更改记录，我的目的是：在不重建git的前提下，仅保留当前版本，把之前所有的<code>commit</code>都删除掉，以此来减小包的大小。</p><h4 id=思路>思路</h4><p>新建一个分支 <code>mains</code> 然后把 <code>master</code> 分支的文件全部添加到 <code>mians</code> 分支中，然后本地和远程都删除<code>master</code>分支，再把<code>mains</code>分支重命名为<code>master</code>，从而清理之前的提交记录。</p><h5 id=新建并切换到分支mains>新建并切换到分支<code>mains</code></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>checkout</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>orphan</span> <span style=color:#a6e22e>mains</span>
</span></span></code></pre></div><h5 id=添加并提交文件到mains分支>添加并提交文件到<code>mains</code>分支</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>add</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>A</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>commit</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>am</span> <span style=color:#e6db74>&#34;清除所有历史版本以减少仓库大小&#34;</span>
</span></span></code></pre></div><h5 id=删除-master>删除 <code>master</code></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>branch</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>D</span> <span style=color:#a6e22e>master</span>
</span></span></code></pre></div><h5 id=mains-重命名><code>mains</code> 重命名</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>branch</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>m</span> <span style=color:#a6e22e>master</span>
</span></span></code></pre></div><h5 id=强制推送>强制推送</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>push</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span> <span style=color:#a6e22e>origin</span> <span style=color:#a6e22e>master</span>
</span></span></code></pre></div><p>如果主分支改变，别的分支没有进行操作的话，将无法从主分支中合并代码到别的分支，最好本地拉取目标分支的文件，然后备份一份，再删除目标分支，从<code>master</code>分支基础上新建目标分支。然后再覆盖备份的文件。
简单操作如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># 切换目标分支（以blog为目标分支为例）
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>checkout</span> <span style=color:#a6e22e>blog</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 拉去仓库blog分支的最新版本 
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>pull</span> 
</span></span><span style=display:flex><span><span style=color:#75715e># 本地备份
</span></span></span><span style=display:flex><span><span style=color:#75715e># 删除分支
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>branch</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>D</span> <span style=color:#a6e22e>blog</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 在master分支下创建分支
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>chekcout</span> <span style=color:#a6e22e>blog</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 覆盖代码
</span></span></span><span style=display:flex><span><span style=color:#75715e># 强制推送到远程
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>push</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>u</span> <span style=color:#a6e22e>origin</span> <span style=color:#a6e22e>blog</span>
</span></span></code></pre></div><p>如果代码已经部署到网站中，那么需要强制拉取，不然本地会有很多 <code>commit</code></p><p><img src=https://www.choudalao.com/uploads/20201008/202010081555555JzewE.png alt></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>fetch</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>all</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>reset</span> <span style=color:#f92672>--</span><span style=color:#a6e22e>hard</span> <span style=color:#a6e22e>origin</span><span style=color:#f92672>/</span><span style=color:#a6e22e>blog</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>pull</span>
</span></span></code></pre></div></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 臭大佬博客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>