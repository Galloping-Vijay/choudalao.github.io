<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>go 语言中代码执行流程 - 臭大佬博客</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="go 语言中代码执行流程"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/choudalao.github.io/css/style.css><link rel="shortcut icon" href=/choudalao.github.io/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/choudalao.github.io/ title=臭大佬博客 rel=home><div class="logo__item logo__text"><div class=logo__title>臭大佬博客</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/choudalao.github.io/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/posts/><span class=menu__text>归档</span></a></li><li class=menu__item><a class=menu__link href=/choudalao.github.io/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>go 语言中代码执行流程</h1></header><div class="content post__content clearfix"><h1 id=说明>说明</h1><p><code>Go</code>程序是通过<code>package</code>来组织的,每个可独立运行的程序都需要包含一个<code>main</code>包，它在编译之后会生成可执行文件；在这个main包中必定包含一个入口函数main,这个函数既没有参数，也没有返回值。 Go 程序中通常包含：包、常量、变量、init()、main()等元素，如果同时存在多个包，包之间存在依赖关系，每个包中存在多个 init 函数，每个文件中存在一个 init 函数，那么问题来了，他们之间的执行顺序是什么样的？通过本文我们来对它们之间的执行顺序做尽可能详尽的说明。</p><p>Go 的执行过程是如下图所示的方式：</p><p><img src=https://www.choudalao.com/uploads/20201123/5fbbcafacf5aa.png alt=go执行流程 title=go执行流程></p><p>下面我们在<code>beego</code>框架下，利用<code>bee</code>的输出测试一下这个流程。</p><p>文件目录结构如下：</p><p><img src=https://www.choudalao.com/uploads/20201123/20201123225912cKNIgX.png alt></p><p>在测试过程中，我们只关心以上圈出四个文件，最外层是 <code>mian.go</code>,然后同级有<code>model</code>和<code>routers</code>两个目录，model目录目录下有<code>init.go</code>和<code>article.go</code>两个文件里面都有 <code>init</code>函数，<code>routers</code>下<code>router.go</code>有 <code>init</code>函数。</p><p>下面是代码</p><h3 id=maingo>main.go</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @Description:
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @User: Vijay &lt;1937832819@qq.com&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @Date: 2020-10-20 22:34:11
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;blogApi/middlewares&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;blogApi/models&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;blogApi/routers&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/astaxie/beego&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_</span> <span style=color:#a6e22e>int</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>returnNum</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;main的init&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 跨域
</span></span></span><span style=display:flex><span>	<span style=color:#a6e22e>middlewares</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CorsDomain</span>()
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 登录验证
</span></span></span><span style=display:flex><span>	<span style=color:#a6e22e>middlewares</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Init</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 测试初始化变量
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>func</span> <span style=color:#a6e22e>returnNum</span>() <span style=color:#a6e22e>int</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;初始化变量&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>beego</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Run</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=blogapimodelsarticlego>blogApi\models\article.go</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>package</span> <span style=color:#a6e22e>models</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;article.go的init&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=blogapimodelsinitgo>blogApi\models\init.go</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>package</span> <span style=color:#a6e22e>models</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>db</span> <span style=color:#66d9ef>interface</span>{} <span style=color:#f92672>=</span> <span style=color:#a6e22e>setDb</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>func</span> <span style=color:#a6e22e>setDb</span>() <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;model的init.go的db初始化&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>111</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;model的inti.go的init&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=blogapiroutersroutergo>blogApi\routers\router.go</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>package</span> <span style=color:#a6e22e>routers</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;router的init&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=执行>执行</h1><p>执行得到如下结果：</p><p><img src=https://www.choudalao.com/uploads/20201123/20201123231710l5A0sl.png alt></p><h1 id=总结>总结</h1><p><code>Go</code>要求非常严格，不允许引用不使用的包。但是有时你引用包只是为了调用<code>init</code>函数去做一些初始化工作。此时空标识符（也就是下划线）的作用就是为了解决这个问题。</p><p>在打印中可以看出执行流程如下，引入包->初始化包变量—>执行包里面的init()->mian.go中初始化变量->init()->mian();</p><p>在mian.go 中我们引入了<code>_ "blogApi/models"</code>和<code>_ "blogApi/routers"</code>初始化，<code>blogApi/models</code>下面又有<code>article.go</code>和<code>init.go</code>有<code>init</code>方法,<code>init.go</code>里面我们还初始化了一个<code>db</code>变量。可以发现：
<strong>同一个<code>package</code>下，变量是自上而下去初始化的，等<code>package</code>包里面的变量全部初始化完后，再自上而下执行<code>init()</code>,</strong></p><p>根据上面特性，如果我们需要在<code>model</code>下初始化<code>db</code>,应该在最前面的文件进行初始化，然后下面的文件都可以调用，出个馊主意，比如定义一个文件名为<code>0init.go</code>的文件,里面写<code>db</code>变量，试一下效果：</p><h4 id=blogapimodels0initgo>blogApi\models\0init.go</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>package</span> <span style=color:#a6e22e>models</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>db</span> <span style=color:#66d9ef>interface</span>{} <span style=color:#f92672>=</span> <span style=color:#ae81ff>111</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;model下0init.go初始化db&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=修改-blogapimodelsarticlego>修改 blogApi\models\article.go</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>package</span> <span style=color:#a6e22e>models</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;model的article.go中能获取到db：%v</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#a6e22e>db</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;article.go的init&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>执行结果：</p><p><img src=https://www.choudalao.com/uploads/20201123/20201123234520gOlngi.png alt></p><p>可以看出，<code>0init.go</code> 定义的变量，在<code>article,go</code>中可以获取到，这样的话，我们就可以在<code>0init.go</code>初始化数据库链接了，这样在整个<code>model</code>下都能拿到数据库句柄了。</p><p>包里面的代码初始化完后，再进行本地<code>mian.go</code>文件变量初始化，然后执行<code>init</code>，最后才去执行<code>mian</code>方法</p><h3 id=init特性及作用>init特性及作用</h3><p><code>init()</code>函数会在每个包完成初始化后自动执行，并且执行优先级比<code>main</code>函数高。</p><h4 id=init-函数的作用>init 函数的作用：</h4><ul><li>对变量进行初始化</li><li>检查/修复程序的状态</li><li>注册</li><li>运行一次计算</li></ul><h4 id=init-函数的特性>init 函数的特性：</h4><ul><li><p><code>init</code>函数不需要传入参数，也不会返回任何值。与<code>main</code>相比而言，<code>init</code>没有被声明，因此也不能被引用。</p></li><li><p>每个源文件只能包含一个<code>init</code>函数。</p></li></ul></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2026 臭大佬博客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> 主题</span></div></div></footer></div><script async defer src=/choudalao.github.io/js/menu.js></script></body></html>